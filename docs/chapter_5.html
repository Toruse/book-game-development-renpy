<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.60">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Глава 5. Погружаемся глубже | Game Development with Ren’Py</title><meta name="description" content="Разработка новелл при помощи Ren`Py, TyranoBuilder и Twine">
    <link rel="preload" href="/book-game-development-renpy/assets/style-5e12265d.css" as="style"><link rel="stylesheet" href="/book-game-development-renpy/assets/style-5e12265d.css">
    <link rel="modulepreload" href="/book-game-development-renpy/assets/app-e2a8f75c.js"><link rel="modulepreload" href="/book-game-development-renpy/assets/framework-5866ffd3.js"><link rel="modulepreload" href="/book-game-development-renpy/assets/chapter_5.html-7a623780.js"><link rel="modulepreload" href="/book-game-development-renpy/assets/chapter_5.html-430466c9.js"><link rel="prefetch" href="/book-game-development-renpy/assets/chapter_1.html-645da8b2.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/chapter_2.html-37ca180d.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/chapter_3.html-f9fb4639.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/chapter_4.html-2a8584c6.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/chapter_6.html-d84fd142.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/chapter_7.html-6d5994f3.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/chapter_8.html-ae1045c5.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/index.html-5078772a.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/sources.html-05473ec3.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/chapter_1.html-e4dc558a.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/chapter_2.html-d53ec68c.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/chapter_3.html-639e9627.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/chapter_4.html-7ff325ef.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/chapter_6.html-22911953.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/chapter_7.html-47612d5c.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/chapter_8.html-1c691f6e.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/index.html-e7e61790.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/sources.html-029eff32.js" as="script"><link rel="prefetch" href="/book-game-development-renpy/assets/404.html-87d54bd8.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/book-game-development-renpy/" class=""><!----><span class="site-name">Game Development with Ren’Py</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><!----><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/book-game-development-renpy/" class="sidebar-item sidebar-heading" aria-label="Разработка игр с помощью Ren’Py"><!--[--><!--]--> Разработка игр с помощью Ren’Py <!--[--><!--]--></a><!----></li><li><a href="/book-game-development-renpy/chapter_1.html" class="sidebar-item sidebar-heading" aria-label="Глава 1. Истории и как они создаются"><!--[--><!--]--> Глава 1. Истории и как они создаются <!--[--><!--]--></a><!----></li><li><a href="/book-game-development-renpy/chapter_2.html" class="sidebar-item sidebar-heading" aria-label="Глава 2. Древнее искусство интерактивной художественной литературы"><!--[--><!--]--> Глава 2. Древнее искусство интерактивной художественной литературы <!--[--><!--]--></a><!----></li><li><a href="/book-game-development-renpy/chapter_3.html" class="sidebar-item sidebar-heading" aria-label="Глава 3. Современные визуальные новеллы"><!--[--><!--]--> Глава 3. Современные визуальные новеллы <!--[--><!--]--></a><!----></li><li><a href="/book-game-development-renpy/chapter_4.html" class="sidebar-item sidebar-heading" aria-label="Глава 4. Знакомимся с Ren’Py, Twine и TyranoBuilder"><!--[--><!--]--> Глава 4. Знакомимся с Ren’Py, Twine и TyranoBuilder <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="Глава 5. Погружаемся глубже"><!--[--><!--]--> Глава 5. Погружаемся глубже <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#ren-py-контеинеры-и-кодеки" class="router-link-active router-link-exact-active sidebar-item" aria-label="Ren’Py, контейнеры и кодеки"><!--[--><!--]--> Ren’Py, контейнеры и кодеки <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#видео-в-ren-py" class="router-link-active router-link-exact-active sidebar-item" aria-label="Видео в Ren’Py"><!--[--><!--]--> Видео в Ren’Py <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#расширенные-функции-аудио-в-ren-py" class="router-link-active router-link-exact-active sidebar-item" aria-label="Расширенные функции аудио в Ren’Py"><!--[--><!--]--> Расширенные функции аудио в Ren’Py <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#подробнеи-о-графике" class="router-link-active router-link-exact-active sidebar-item" aria-label="Подробней о графике"><!--[--><!--]--> Подробней о графике <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#настроика-графического-интерфеиса-в-ren-py" class="router-link-active router-link-exact-active sidebar-item" aria-label="Настройка графического интерфейса в Ren’Py"><!--[--><!--]--> Настройка графического интерфейса в Ren’Py <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#продвинутые-функции-tyranobuilder" class="router-link-active router-link-exact-active sidebar-item" aria-label="Продвинутые функции TyranoBuilder"><!--[--><!--]--> Продвинутые функции TyranoBuilder <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#плагины" class="router-link-active router-link-exact-active sidebar-item" aria-label="Плагины"><!--[--><!--]--> Плагины <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#переменные" class="router-link-active router-link-exact-active sidebar-item" aria-label="Переменные"><!--[--><!--]--> Переменные <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#случаиныи-диалог" class="router-link-active router-link-exact-active sidebar-item" aria-label="Случайный диалог"><!--[--><!--]--> Случайный диалог <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#iscript-в-сравнении-с-javascript" class="router-link-active router-link-exact-active sidebar-item" aria-label="iScript в сравнении с JavaScript"><!--[--><!--]--> iScript в сравнении с JavaScript <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#кликабельные-области-изображения" class="router-link-active router-link-exact-active sidebar-item" aria-label="Кликабельные области изображения"><!--[--><!--]--> Кликабельные области изображения <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#пользовательские-шрифты" class="router-link-active router-link-exact-active sidebar-item" aria-label="Пользовательские шрифты"><!--[--><!--]--> Пользовательские шрифты <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#магия-twine" class="router-link-active router-link-exact-active sidebar-item" aria-label="Магия Twine"><!--[--><!--]--> Магия Twine <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#вызов-javascript-в-twine" class="router-link-active router-link-exact-active sidebar-item" aria-label="Вызов JavaScript в Twine"><!--[--><!--]--> Вызов JavaScript в Twine <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#анимация-раскрытия-текста-в-css" class="router-link-active router-link-exact-active sidebar-item" aria-label="Анимация раскрытия текста в CSS"><!--[--><!--]--> Анимация раскрытия текста в CSS <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#оживляем-текст" class="router-link-active router-link-exact-active sidebar-item" aria-label="Оживляем текст"><!--[--><!--]--> Оживляем текст <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#знакомимся-с-форматом-истории-harlowe" class="router-link-active router-link-exact-active sidebar-item" aria-label="Знакомимся с форматом истории Harlowe"><!--[--><!--]--> Знакомимся с форматом истории Harlowe <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#знакомимся-с-snowman" class="router-link-active router-link-exact-active sidebar-item" aria-label="Знакомимся с Snowman"><!--[--><!--]--> Знакомимся с Snowman <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/book-game-development-renpy/chapter_5.html#заключение" class="router-link-active router-link-exact-active sidebar-item" aria-label="Заключение"><!--[--><!--]--> Заключение <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/book-game-development-renpy/chapter_6.html" class="sidebar-item sidebar-heading" aria-label="Глава 6. Запускаем на популярных платформах"><!--[--><!--]--> Глава 6. Запускаем на популярных платформах <!--[--><!--]--></a><!----></li><li><a href="/book-game-development-renpy/chapter_7.html" class="sidebar-item sidebar-heading" aria-label="Глава 7."><!--[--><!--]--> Глава 7. <!--[--><!--]--></a><!----></li><li><a href="/book-game-development-renpy/chapter_8.html" class="sidebar-item sidebar-heading" aria-label="Глава 8."><!--[--><!--]--> Глава 8. <!--[--><!--]--></a><!----></li><li><a href="/book-game-development-renpy/sources.html" class="sidebar-item sidebar-heading" aria-label="Источники"><!--[--><!--]--> Источники <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="глава-5-погружаемся-глубже" tabindex="-1"><a class="header-anchor" href="#глава-5-погружаемся-глубже" aria-hidden="true">#</a> Глава 5. Погружаемся глубже</h1><p>Дойдя до этой главы, вы уже усвоили базовые теоретические и практические знания по <em>Ren’Py</em>, <em>Twine</em> и <em>TyranoBuilder</em>. Теперь познакомимся с более сложными инструментами, которые имеются в рассматриваемом программном обеспечении. Например, разберём, как интегрировать видео в Ren’Py, как улучшить игры на Twine при помощи каскадных таблиц стилей (CSS), и как создать произвольный диалог в TyranoBuilder.</p><h2 id="ren-py-контеинеры-и-кодеки" tabindex="-1"><a class="header-anchor" href="#ren-py-контеинеры-и-кодеки" aria-hidden="true">#</a> Ren’Py, контейнеры и кодеки</h2><p>Информация о форматах видео, по сути, не касается Ren’Py, TyranoBuilder или Twine, но она может оказаться полезной при работе с аудиовизуальными эффектами в проекте.</p><p>Видео (и аудио) файл обычно состоит из двух компонентов это контейнер и кодек. Контейнер — это файл, который содержит в себе видео, аудио и субтитры. В свою очередь кодек является инструментом для сжатия и распаковки видеофайла внутри контейнера. Существует многое количество кодеков, которые различаются между собой качеством и коэффициентом сжатия. Самыми популярными форматы контейнеров являются <em>.ogg</em>, <em>.webm</em> и <em>.avi</em>, и соответственно они имеют поддержку на многих платформах как на настольных, так и на мобильных.</p><p>Что касается кодеков, то хорошим выбором является <em>H.264</em> (известный как <em>MPEG-4</em>), <em>MPEG-2</em> и <em>MPEG-1</em>. Данный формат был разработан в 1988 году <em>Хироси Ясудой</em> и <em>Леонардо Кьярильоне</em>, а аббревиатура <em>MPEG (Moving Picture Experts Group)</em> расшифровывается как <em>Экспертная группа по движущимся изображениям</em>.</p><p>Давайте, используя таблицу 5-1, сравним самые распространённые кодеки:</p><p><strong>Таблица 5-1.</strong> Наиболее распространенные видеокодеки</p><table><thead><tr><th>Кодек</th><th>Лицензия</th><th>Дата релиза</th><th>Особенности</th></tr></thead><tbody><tr><td><em>VP9</em></td><td>Свободная</td><td>2012</td><td>Поддержка видео высокого разрешения (например, 4K/8K UHD), опция сжатия без потерь</td></tr><tr><td><em>VP8</em></td><td>Свободная</td><td>2008</td><td>Поддержка многопроцессорности. Свободный доступ для редактирования видео. Лучше всего использовать для видео с низким разрешением</td></tr><tr><td><em>Theora</em></td><td>Свободная</td><td>2004</td><td>Поддерживает потоковую передачу видео через Интернет, достоянная картинка при низком битрейте</td></tr><tr><td><em>H.264 (MPEG-4)</em></td><td>Бесплатная для использования в Интернете</td><td>2003</td><td>Эффективен для потокового видео через Интернет, поддерживает разрешение до 8192 × 4320 (включая 8K UHD)</td></tr><tr><td><em>Xvid, бесплатная реализация MPEG-4 part 2</em></td><td>Свободная (Универсальная общественная лицензия GNU)</td><td>2001</td><td>Оптимизирована производительность, широкая поддержка</td></tr><tr><td><em>MPEG-2</em></td><td>Все американские патенты MPEG-2 истекли 13 февраля 2019 года</td><td>1996</td><td>Формат золотой стандарт DVD, может включать объемный звук 5.1</td></tr><tr><td><em>MPEG-1</em></td><td>Свободная (срок действия патентов истек)</td><td>1989</td><td>Хорошо работает с видео с низким битрейтом (например, для небольших дисплеев), принимая во внимание как качество изображения, так и небольшой размер файла.</td></tr></tbody></table><p>Теперь при помощи таблицы 5-2 сравним форматы контейнеров:</p><p><strong>Таблица 5-2.</strong> Наиболее распространенные видео контейнеры</p><table><thead><tr><th>Формат контейнера</th><th>Лицензия</th><th>Дата релиза</th><th>Поддерживаемые кодеки</th></tr></thead><tbody><tr><td><em>WebM</em></td><td>Свободная</td><td>2010</td><td>Видео VP8 и VP9, аудио Ogg Vorbis и Opus audio</td></tr><tr><td><em>Matroska</em></td><td>Свободная</td><td>2002</td><td>Любой</td></tr><tr><td><em>Ogg</em></td><td>Свободная</td><td>1993</td><td>Видео Theora и Dirac. Аудио Opus, Vorbis и Speex</td></tr><tr><td><em>MPEG-контейнер (не путать с MPEG-кодеками)</em></td><td>Ограниченна</td><td>1993</td><td>Видео MPEG-1 и MPEG-2. Аудио MPEG-1 Layers 1, 2, и 3 (то есть mp3)</td></tr><tr><td><em>AVI</em></td><td>Относительно свободная</td><td>1992</td><td>В основном содержит несжатое видео (Full Frame), Intel Real Time (Indeo) и Cinepak</td></tr></tbody></table><h3 id="видео-в-ren-py" tabindex="-1"><a class="header-anchor" href="#видео-в-ren-py" aria-hidden="true">#</a> Видео в Ren’Py</h3><p>Воспроизвести видео в Ren’Py относительно простая задача. Благодаря поддержке нескольких широко распространённых видеоформатов, вам не придётся прибегать к трудному процессу преобразованию видео из одного формата в другой.</p><p>Следующая строка кода, добавленная в сценарий, воспроизведёт видео во весь размер окна игры:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>$ renpy<span class="token punctuation">.</span>movie_cutscene<span class="token punctuation">(</span><span class="token string">&quot;introvideo.webm&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Видео будет проигрываться до тех пор, пока не достигнет своего конца или пока игрок не щелкнет мышью. Но этим Ren’Py не ограничивается. Вы можете использовать видео как фон или как изображение персонажа.</p><p>Давайте рассмотрим пример:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>    image markus movie <span class="token operator">=</span> Movie<span class="token punctuation">(</span>play<span class="token operator">=</span><span class="token string">&quot;markus_movie.webm&quot;</span><span class="token punctuation">,</span> mask<span class="token operator">=</span><span class="token string">&quot;markus_mask.webm&quot;</span><span class="token punctuation">)</span>
    show markus movie
    <span class="token string">&quot;Разве это не весело?&quot;</span>
    hide markus movie
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Данный код в первой строке определяет <em>видео спрайт</em> (<em>movie sprite</em>) с именем &quot;markus&quot;, которому присваивается видеофайл <em>markus_movie.webm</em>. Далее командой show воспроизводиться видео. Потом выводиться диалог, а затем видео скрывается командой hide.</p><p>Как мы знаем видео имеет квадратную или прямоугольную форму и не имеет прозрачности. Чтобы скрыть нежелательные края или фон в видео спрайте во время вызова метода Movie указывается параметр <em>mask</em> (<em>маска</em>). <em>Маска</em> – это видео такого же размера и продолжительности, что и видео, с которым она связана.</p><p>Что касается Ren’Py, то в маске белый цвет обозначает видимую область, а черный — область, которую нужно скрыть.</p><h3 id="расширенные-функции-аудио-в-ren-py" tabindex="-1"><a class="header-anchor" href="#расширенные-функции-аудио-в-ren-py" aria-hidden="true">#</a> Расширенные функции аудио в Ren’Py</h3><p>Во время разработки игры возникает потребность одновременно воспроизводить фоновую музыку, звуковые эффекты, голоса персонажей. Для это в Ren&#39;Py используется подход, при котором один аудиоканал используется для воспроизведения музыки, второй для звука, и ещё один для голоса. Каждый из этих каналов воспроизводит по одному аудиофайлу за раз. Если вам потребуется дополнительный аудиоканал вы можете его создать. Как это сделать будет показано далее в книге.</p><p>Нижеприведённом примере используются сразу все три канала для одновременного воспроизведения песни, звукового эффекта и диалога.</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>    play music <span class="token string">&quot;song1.ogg&quot;</span>
    play sound <span class="token string">&quot;boom.mp3&quot;</span>
    voice <span class="token string">&quot;dialogue1.ogg&quot;</span>
    <span class="token string">&quot;Привет, как ты?&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Ren’Py поддерживает <em>.wav</em>, <em>.ogg</em>, <em>.mp3</em> и <em>Opus</em> форматы. Из них формат .wav (который является стандартным аудио форматом для компакт-дисков), пожалуй, самый громоздкий, так как не имеет сжатия, его не рекомендуется для использования в релизной версии игры. Никто не любит, когда игра занимает много дискового пространства, а особенно когда она распространяется через Интернет (то есть будет долго загружаться). Наилучшее применение .wav формата – это когда звук находится на стадии обработки, и только после выполнения всех работ, его можно сохранить в формат с элементом сжатие. Имейте виду, при сжатии идёт потеря качества аудиодорожки, в результате вы получаете копию, а не оригинал. Если это повторить несколько раз, то качество звука сильно упадёт.</p><h4 id="аудио-очереди" tabindex="-1"><a class="header-anchor" href="#аудио-очереди" aria-hidden="true">#</a> Аудио очереди</h4><p>Игра будет более приятно восприниматься, когда в место одной короткой повторяющейся мелодии будет плейлист с разнообразной музыкой. Это можно легко сделать в Ren’Py при помощи метода <em>queue</em>. В примере показано, как создается очередь из трех мелодий (в формате .ogg) для музыкального канала.</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>queue music <span class="token punctuation">[</span> <span class="token string">&quot;song1.ogg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;song2.ogg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;happysong.ogg&quot;</span> <span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="параметры-операторов-воспроизведения-и-остановки" tabindex="-1"><a class="header-anchor" href="#параметры-операторов-воспроизведения-и-остановки" aria-hidden="true">#</a> Параметры операторов воспроизведения и остановки</h4><p>Оператор play не ограничивается простым открытием файла и его воспроизведением. Например, вы можете передать в него очередь аудиофайлов, задать затухание в начале и в конце.</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>play music <span class="token punctuation">[</span> <span class="token string">&quot;song1.mp3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;song2.mp3&quot;</span> <span class="token punctuation">]</span> fadeout <span class="token number">2.0</span> fadein <span class="token number">2.0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Если вы хотите остановить воспроизведение музыкального канала с затуханием длиной в 10 секунд, то нужно в операторе stop указать следующие параметры:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>stop music fadeout <span class="token number">10.0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Если вам когда-нибудь понадобится вставить паузу перед воспроизведением, то воспользуйтесь тегом silence (тишина) с параметром длительность тишины в секундах.</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>play audio <span class="token punctuation">[</span> <span class="token string">&quot;&lt;silence 2.5&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;song1.mp3&quot;</span> <span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="воспроизводим-произвольную-часть-аудиофаила" tabindex="-1"><a class="header-anchor" href="#воспроизводим-произвольную-часть-аудиофаила" aria-hidden="true">#</a> Воспроизводим произвольную часть аудиофайла</h4><p>Ren’Py при помощи оператора from позволяет прослушать часть аудиофайла. В приведённом примере воспроизводиться аудио <em>song1.mp3</em> с 2,5 секунды до 10,5 секунды.</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>play music <span class="token string">&quot;&lt;from 2.5 to 10.5&gt;song1.mp3&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="подробнеи-о-графике" tabindex="-1"><a class="header-anchor" href="#подробнеи-о-графике" aria-hidden="true">#</a> Подробней о графике</h3><p>Ren&#39;Py может не только скрывать и показывать изображения, а имеет ряд дополнительных методов для работы с ними. Давайте познакомимся с наиболее полезными.</p><h4 id="цвет-диалога" tabindex="-1"><a class="header-anchor" href="#цвет-диалога" aria-hidden="true">#</a> Цвет диалога</h4><p>В предыдущей главе мы уже встречались с инициализацией персонажа и это выглядело так:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>$ m <span class="token operator">=</span> Character<span class="token punctuation">(</span><span class="token string">&#39;Маркус&#39;</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">&quot;#EE1100&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Но в этот раз мы указали свойство color, которое задает цвет диалога персонажа в виде шестнадцатеричного значения. Оно в свою очередь состоит из красного, зеленого и синего цвета (т. е. RGB). Первые два символа после хэштега (#) задают значение красного цвета, третий и четвертый задают значение зеленого, а остальные символы задают значение синего цвета. Так как шестнадцатеричная система в качестве цифр счисления использует цифры от 0 до 9 и латинские буквы от A до F, то мы видим буквенные значения в определении цвета.</p><p>Такую же цветовую модель используют в HTML, CSS и во всех игровых движках, описанных в этой книге. В нашем примере персонажу Маркуса указывается красный цвет диалога с вкраплением зелёного.</p><p>Давайте познакомимся с наиболее распространёнными цветами типа RGB (см. Таблице 5-3).</p><p><strong>Таблица 5-3.</strong> Наиболее популярные RGB цвета</p><table><thead><tr><th>Цвет</th><th>Шестнадцатеричное значение</th></tr></thead><tbody><tr><td><em>Черный</em></td><td>#000000</td></tr><tr><td><em>Белый</em></td><td>#FFFFFF</td></tr><tr><td><em>Серый</em></td><td>#808080</td></tr><tr><td><em>Зеленый</em></td><td>#008000</td></tr><tr><td><em>Синий</em></td><td>#0000FF</td></tr><tr><td><em>Желтый</em></td><td>#FFFF00</td></tr><tr><td><em>Красный</em></td><td>#FF0000</td></tr><tr><td><em>Фиолетовый</em></td><td>#800080</td></tr><tr><td><em>Апельсин</em></td><td>#FFA500</td></tr><tr><td><em>Берливуд</em></td><td>#DEB887</td></tr></tbody></table><h4 id="выравниваем-изображения" tabindex="-1"><a class="header-anchor" href="#выравниваем-изображения" aria-hidden="true">#</a> Выравниваем изображения</h4><p>Если вам нужно отцентрировать изображение в независимости от позиции в пикселях, то укажите следующие параметры <em>xalign</em> и <em>yalign</em>. Параметр xalign задает выравнивание по горизонтали, если указать 0,0 — изображение выровняется по левому краю, если указать 0,5 — то по центру, если 1,0 — то по правому краю. Соответственно параметр yalign выполняет выравнивание по вертикали, если указать 0,0 – выполниться выравнивание по верхнему краю, 0,5 — по центру, а значение 1,0 выровняет изображение по нижнему краю экрана.</p><p>В следующей строке кода загружается файла <em>man.png</em>, который при выводе на экран отображаться в нижнем правом углу.</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>image man right <span class="token operator">=</span> Image<span class="token punctuation">(</span><span class="token string">&quot;man.png&quot;</span><span class="token punctuation">,</span> xalign<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> yalign<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="добавляем-переходы" tabindex="-1"><a class="header-anchor" href="#добавляем-переходы" aria-hidden="true">#</a> Добавляем переходы</h4><p>Ren’Py имеет набор переходов между сценами. Чтобы их применить используется функция <em>with</em>. Если нужно настроить переходы для глобальных элементов игры используйте конфигурационные файлы <em>gui.rpy</em> или <em>options.rpy</em>.</p><p>Рассмотрим пример использования перехода:</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>show bg garage
<span class="token keyword">with</span> dissolve
<span class="token string">&quot;Черт возьми! Эрни! Мы в гараже!&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Как видим скрипт выводит фоновое изображение гаража, используя классический переход <em>dissolve</em> (<em>растворение</em>).</p><p>Теперь давайте рассмотрим какие есть ещё переходы в Ren’Py (см. Таблицу 5-4).</p><p><strong>Таблица 5-4.</strong> Основные визуальные переходы в Ren’Py</p><table><thead><tr><th>Переход</th><th>Описание</th></tr></thead><tbody><tr><td><em>dissolve</em></td><td>Изображение исчезает или показывается с затуханием</td></tr><tr><td><em>fade</em></td><td>Изображение, темнея исчезает или появляется из темноты</td></tr><tr><td><em>pixellate</em></td><td>Изображение пикселизируется при исчезновении или депикселизируется при появлении</td></tr><tr><td><em>blinds</em></td><td>Смена сцены при помощи эффекта &quot;вертикальные жалюзи&quot;</td></tr><tr><td><em>zoomin</em></td><td>Новое изображение появляется с эффектом увеличения</td></tr><tr><td><em>zoominout</em></td><td>Изображение исчезает с эффектом уменьшения</td></tr><tr><td><em>move</em></td><td>Анимирует перемещение изображения изменившее местоположение</td></tr><tr><td><em>slideawayleft</em>, <em>slideawayright</em>, <em>slideawayup</em>, <em>slideawaydown</em></td><td>Сдвигает старую сцену в заданном направлении</td></tr><tr><td><em>slideleft</em>, <em>slideright</em>, <em>slideup</em>, <em>slidedown</em></td><td>Сдвигает новую сцену в заданном направлении</td></tr><tr><td><em>Vpunch</em></td><td>При вызове этого перехода встряхивает экран в вертикальном направлении</td></tr><tr><td><em>Hpunch</em></td><td>При вызове этого перехода встряхивает экран в горизонтальном направлении</td></tr><tr><td><em>easeinleft</em>, <em>easeinright</em>, _easeintop, <em>easeinbottom</em></td><td>Похож на move, за исключением того, что скорость движения строится на основе кривой косинуса</td></tr><tr><td><em>irisin</em>, <em>irisout</em></td><td>Показывает новое изображение или скрывает текущее с помощью прямоугольника</td></tr><tr><td><em>Squares</em></td><td>Переход изображения квадратами</td></tr><tr><td><em>wipeleft</em>, <em>wiperight</em>, <em>wipeup</em>, <em>wipedown</em></td><td>Стирает изображение в указанном направлении</td></tr><tr><td><em>moveoutright</em>, <em>moveoutleft</em>, <em>moveouttop</em>, <em>moveoutbottom</em></td><td>Перемещает изображение за пределы экрана</td></tr><tr><td><em>moveinright</em>, <em>moveinleft</em>, <em>moveintop</em>, <em>moveinbottom</em></td><td>Переход выводит изображения на экран с соответствующей стороны</td></tr></tbody></table><p>Лучшим способом познакомиться с переходами в Ren’Py, — это, поэкспериментировать с ними. Никогда не знаешь, какую можно получить атмосферу в сцене комбинируя их.</p><h3 id="настроика-графического-интерфеиса-в-ren-py" tabindex="-1"><a class="header-anchor" href="#настроика-графического-интерфеиса-в-ren-py" aria-hidden="true">#</a> Настройка графического интерфейса в Ren’Py</h3><p>Все элементы графического интерфейса (GUI) в Ren’Py можно настроить, отредактировав файл <em>gui.rpy</em>. Доступ к нему можно получить через лаунчер в разделе <em>&quot;Редактировать файл&quot;</em>. Этот текстовый файл содержит множество настроек, давайте рассмотрим некоторые из них (см. Таблицу 5-5).</p><p><strong>Таблица 5-5.</strong> Полезные опции в файле <strong>gui.rpy</strong></p><table><thead><tr><th>Опция</th><th>Описание</th></tr></thead><tbody><tr><td><em>define gui.text_size</em></td><td>Размер текста диалога. По умолчанию: 22</td></tr><tr><td><em>define gui.text_color</em></td><td>Устанавливает цвет текста диалога. По умолчанию: белый (#ffffff)</td></tr><tr><td><em>define gui.textbox_height</em></td><td>Устанавливает высоту диалогового окна. По умолчанию: 185 пикселей</td></tr><tr><td><em>define gui.name_text_size</em></td><td>Задаёт размер имен персонажей. По умолчанию: 30</td></tr><tr><td><em>define gui.text_font</em></td><td>Определяет внутриигровой шрифт. Файл со шрифтом должен находиться в папке с игрой. По умолчанию: DejaVuSans.ttf</td></tr><tr><td><em>define gui.main_menu_background</em></td><td>Задаёт фоновое изображение главного меню игры. По умолчанию: &quot;gui/main_menu.png&quot;</td></tr><tr><td><em>define gui.game_menu_background</em></td><td>Задаёт фоновое изображение игровом меню игры. По умолчанию: &quot;gui/game_menu.png&quot;</td></tr><tr><td><em>define gui.title_text_size</em></td><td>Устанавливает размер заголовка игры. По умолчанию: 50</td></tr><tr><td><em>define gui.interface_text_size</em></td><td>Устанавливает размер текста в пользовательском интерфейсе. По умолчанию: 22</td></tr><tr><td><em>define gui.label_text_size</em></td><td>Устанавливает размер заголовка в пользовательском интерфейсе. По умолчанию: 24</td></tr></tbody></table><p>Файл gui.rpy — это не единственный файл, который позволяет настроить работу Ren’Py, ещё имеется <em>options.rpy</em>. Его так же можно открыть через лаунчер в разделе <em>&quot;Редактировать файл&quot;</em>. Давайте разберём некоторые настройки из этого файла и что они значат для визуальной новеллы (см. Таблицу 5–6).</p><p><strong>Таблица 5-6.</strong> Полезные опции в файле <strong>options.rpy</strong></p><table><thead><tr><th>Опция</th><th>Описание</th></tr></thead><tbody><tr><td><em>define gui.show_name</em></td><td>Определяет, показывать ли заголовок игры, на экране главного меню. По умолчанию: True</td></tr><tr><td><em>define config.has_sound</em></td><td>Показывает или скрывает звуковой микшер. По умолчанию: True</td></tr><tr><td><em>define config.has_music</em></td><td>Показывает или скрывает микшер музыки. По умолчанию: True</td></tr><tr><td><em>define config.has_voice</em></td><td>Показывает или скрывает микшер голоса в игре. По умолчанию: True</td></tr><tr><td><em>default preferences.text_cps</em></td><td>Контролирует скорость вывода текста. По умолчанию: 0 — мгновенно. Число больше нуля — это количество печатаемых символов в секунду.</td></tr><tr><td><em>default preferences.afm_time</em></td><td>Устанавливает задержку при авточтении. По умолчанию: 15. Допустимый диапазон значений от 0 до 30.</td></tr><tr><td><em>define config.window_icon</em></td><td>Иконка значка на панеле задач и рабочем столе. По умолчанию: &quot;gui/window_icon.png&quot;</td></tr><tr><td><em>define config.intra_transition</em></td><td>Задаёт типом перехода между экранами игрового меню. По умолчанию: dissolve</td></tr><tr><td><em>define config.enter_transition</em>, <em>define config.exit_transition</em></td><td>Управляет типом визуального перехода при входе и выходе из игрового меню. По умолчанию: dissolve</td></tr><tr><td><em>define config.after_load_transition</em></td><td>Устанавливает эффект перехода после загрузки игры. По умолчанию: None</td></tr></tbody></table><h2 id="продвинутые-функции-tyranobuilder" tabindex="-1"><a class="header-anchor" href="#продвинутые-функции-tyranobuilder" aria-hidden="true">#</a> Продвинутые функции TyranoBuilder</h2><p>Хотя TyranoBuilder кажется простым инструментом разработки, но на самом деле под его капотом скрываются мощные методы для создания игр. Давайте познакомимся с некоторыми из них.</p><h3 id="плагины" tabindex="-1"><a class="header-anchor" href="#плагины" aria-hidden="true">#</a> Плагины</h3><p>TyranoBuilder имеет возможность расширять свой функционал при помощи <em>плагинов</em>. Они могут быть как платные, так и бесплатные. На данный момент их уже существует десятки.</p><blockquote><p><strong>Примечание:</strong></p><p>Поддержка плагинов в TyranoBuilder была добавлена с версии 182.</p></blockquote><p>Познакомится с плагинами можно на странице: <a href="https://plugin.tyrano.jp/" target="_blank" rel="noopener noreferrer">https://plugin.tyrano.jp/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> или на <a href="https://plugin.tyrano.jp/en" target="_blank" rel="noopener noreferrer">https://plugin.tyrano.jp/en<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (английская версия).</p><p>Чтобы добавить плагин в TyranoBuilder, сперва его нужно загрузить с указанного выше ресурса. Затем в главном меню выбираем <em>Project\Plugins</em> (<em>Проект\Плагины</em>), после чего откроется диалоговое окно «Плагины». Далее нажимаем кнопку <em>Add New</em> (<em>Добавить новый</em>), и выбираем ранее загруженный файл с расширением <em>.tbp</em>.</p><p>Для того чтобы воспользоваться встроенными и загруженными плагинами в главном меню выбираем <em>Project\Customize Tool Area</em> (<em>Проект\Настройка области инструментов</em>). В появившемся диалоговом окне на вкладке <em>Components</em> (<em>Компоненты</em>) находим <em>Plugins</em> и ставим флажок. После нажатия кнопки <em>Apply</em> (<em>Применить</em>) на вкладке с компонентами появится новый раздел Plugins (Плагины).</p><p>Хотя плагинов может существовать разное множество, давайте познакомимся с некоторыми из них (см. Таблицу 5-7).</p><p><strong>Таблица 5-7.</strong> Плагины TyranoBuilder и назначение</p><table><thead><tr><th>Плагин</th><th>Описание</th><th>URL</th></tr></thead><tbody><tr><td><em>Background Mask Transitions</em></td><td>Плагин позволяет выполнять смену фона с использованием маски. Содержит в себе множество различных переходов</td><td>https://plugin.tyrano.jp/item/20007</td></tr><tr><td><em>Mask Transitions</em></td><td>Плагин позволяет добавить переходы на основе масок для персонажей. В комплекте 200 масок.</td><td>https://plugin.tyrano.jp/item/20014</td></tr><tr><td><em>Sleep and Awake</em></td><td>Позволяет игроку сохранить её и начать другой квест, а затем по своему желанию вернуться к исходному приключению.</td><td>https://plugin.tyrano.jp/item/20001</td></tr><tr><td><em>Custom Save Game Thumbnail</em></td><td>Позволяет установить миниатюры для сохранений игры вместо захваченных TyranoBuilder.</td><td>https://plugin.tyrano.jp/item/20002</td></tr><tr><td><em>Auto Save and Load</em></td><td>Добавляет компоненты, которые могут в игре выполнять автозагрузку и автосохранение.</td><td>https://plugin.tyrano.jp/item/20003</td></tr><tr><td><em>Show Dialogue</em></td><td>Выводит диалоговое окно подтверждения поверх всех элементов игры.</td><td>https://plugin.tyrano.jp/item/20009</td></tr><tr><td><em>Change Title</em></td><td>Позволяет изменить заголовок окна игры. Например, можно использовать для отображения названия каждой главы новеллы.</td><td>https://plugin.tyrano.jp/item/20010</td></tr><tr><td><em>Screen Filters</em></td><td>Добавляет компонент, который накладывает фильтр на экран игры. Включает в себя эффект размытия, прозрачности, оттенки серого, сепии, инверсию тонов.</td><td>https://plugin.tyrano.jp/item/20005</td></tr><tr><td><em>Open Website</em></td><td>Позволяет запустить браузер и открыть в нем веб-сайт.</td><td>https://plugin.tyrano.jp/item/20008</td></tr><tr><td><em>Sprite Sheets</em></td><td>Обеспечивает поддержку спрайтовой анимации. Имеет настройки: скорость воспроизведения, зацикливание и размер спрайтов.</td><td>https://plugin.tyrano.jp/item/20012</td></tr></tbody></table><h3 id="переменные" tabindex="-1"><a class="header-anchor" href="#переменные" aria-hidden="true">#</a> Переменные</h3><p>Переменные — это важная часть любой визуальной новеллы. Благодаря им вы можете хранить количество золота, которое имеет игрок или определить какое впечатление производит он или она друг на друга на основе их интересов. Для работы с переменными в TyranoBuilder имеется <em>Variables Manager</em> (<em>Диспетчер переменных</em>). Чтобы его открыть, выберите в главном меню Project\Variables (Проект\Переменные) (см. рис. 5-1). Сами переменные записываются в сохранении игры.</p><p><img src="/book-game-development-renpy/assets/figure_5_1-52feaecb.png" alt="Рисунок 5-1. Диспетчер переменных в TyranoBuilder"></p><p><strong>Рисунок 5-1.</strong> Диспетчер переменных в TyranoBuilder</p><p>TyranoBuilder также имеет <em>системные переменные</em>, которые хранятся независимо от функции сохранения игры. Такие переменные можно использовать, например, для подсчёта количества раз прохождения квеста и в результате игроку предложить альтернативную концовку.</p><p>Чтобы выполнить операции над переменными в TyranoBuilder имеется группа компонентов <em>System</em> (<em>Система</em>), в которую входят три компонента: <em>Process Variable</em> (<em>Операция над переменной</em>), <em>Input Box</em> (<em>Поле ввода</em>) и <em>Commit Input</em> (<em>Зафиксировать ввод</em>). Основным компонентом является Process Variable (см. рис. 5-2), который позволяет выполнить арифметические операции над переменной или присвоить ей случайное значение.</p><p><img src="/book-game-development-renpy/assets/figure_5_2-340fa71f.png" alt="Рисунок 5-2. Панель параметров компонента Process Variable"></p><p><strong>Рисунок 5-2.</strong> Панель параметров компонента Process Variable</p><p>Теперь, чтобы переменные повлияли на историю, достаточно воспользоваться компонентом <em>Jump</em> из группы компонентов <em>Story</em>, и в параметрах компонента поставить флажок возле <em>&quot;Jump if conditional is TRUE&quot;</em>. Как показано на рисунке 5-3.</p><p><img src="/book-game-development-renpy/assets/figure_5_3-f5dff9b6.png" alt="Рисунок 5-3. Панель параметров компонента Process Variable"></p><p><strong>Рисунок 5-3.</strong> Панель параметров компонента Process Variable</p><p>Как видим в добавленном компоненте перехода настроен переход на сцену <em>scene2</em> к метке <em>Room</em>, но он выполниться только при условии, что переменная <em>gold</em> (<em>золото</em>) будет больше 10.</p><p>Для создания поля ввода, например, получить имя игрока, используются компонент <em>Input Box</em> и <em>Commit Input</em>. Для этого нужно перетянуть Input Box на сцену, а в параметрах задать имя переменной в поле <em>Assign Variable</em> (<em>Назначить переменную</em>). Используя инструмент позиционирования, можно задать нужное положения поля на сцене. Чтобы зафиксировать ввод данных и присвоить их переменной, перетяните на сцену компонент Commit Input.</p><h3 id="случаиныи-диалог" tabindex="-1"><a class="header-anchor" href="#случаиныи-диалог" aria-hidden="true">#</a> Случайный диалог</h3><p>В современных визуальных новеллах редко используют такой трюк как случайный диалог. Это когда из заранее заготовленного списка фраз или слов берётся случайный вариант и вставляется в диалог. Хотя это может никак не повлиять на основной сюжет, но добавит разнообразия в игру.</p><p>Для этого нам понадобиться компоненты <em>iScript</em> и <em>TyranoScript</em>.</p><p>Откройте проект с прошлой главы или создайте новый. Далее, перетащите компонент iScript поверх компонента <em>&quot;Text&quot;</em>. Затем добавим компонент TyranoScript между созданным компонентом iScript и компонентом Text. Теперь скопируем следующий код в iScript.</p><div class="language-iScript line-numbers-mode" data-ext="iScript"><pre class="language-iScript"><code>itemArray = [
  &quot;яблоко&quot;,
  &quot;ключи&quot;,
  &quot;огурец&quot;,
  &quot;федору&quot;,
  &quot;наушники&quot;,
  &quot;картошку&quot;
];

randomItem = itemArray[Math.floor(Math.random()*itemArray.length)];
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>В данном скрипте мы определяем массив <em>itemArray</em>, переменную, которая хранит в себе несколько значений. Сами значения могут быть числами, символами или строками. Название переменной может быть произвольным, но в данном случае логичней использовать имя itemArray.</p><p>Далее мы определяем переменную <em>randomItem</em>, и помещаем в неё случайно выбранное значение из массива itemArray. Для этого благодаря функции <em>Math.random()</em> генерируем случайное число от 0 до 1 и умножаем на длину массива <em>itemArray.length</em>, в результате получим значение от 0 до 5 в виде цифры с плавающей запятой, например, &quot;4,34234&quot;. Чтобы это исправить воспользуемся функцией <em>Math.floor</em>, которая округлит число до 4.</p><p>Теперь, вставим следующую строку кода в компонент TyranoScript:</p><div class="language-TyranoScript line-numbers-mode" data-ext="TyranoScript"><pre class="language-TyranoScript"><code>[eval exp=&quot;randomitem_text=randomItem&quot;]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Как видим, используя тег eval exp создаётся переменная <em>randomitem_text</em>, которой присваивается значение randomItem. То есть мы приводим неизвестный тип переменной randomItem к строковому типу. Это делается из-за того, что экран отображает только строки.</p><p>И в конце мы вставляем <em>randomitem_text</em> в компонент Text, как показано в примере ниже:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Привет!
О, нет! Я потерял [emb exp=&quot;randomitem_text&quot;]!
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Запускаем проект, и на экране отобразится что-то вроде «Привет! О, нет! Я потерял огурец!».</p><p>Заметьте, в показанном примере используется тег <em>emb</em> для встраивания выражений в диалог.</p><p>Если задуматься об оптимизации скрипта, то шаг с компонентом TyranoScript можно пропустить, а в компоненте Text указать следующий код:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Привет!
О, нет! Я потерял [emb exp=&quot;randomItem&quot;]!
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="iscript-в-сравнении-с-javascript" tabindex="-1"><a class="header-anchor" href="#iscript-в-сравнении-с-javascript" aria-hidden="true">#</a> iScript в сравнении с JavaScript</h3><p>Глобальные переменные в JavaScript объявляются при помощи ключевого слова <em>var</em>, а так как это язык с динамической типизацией, то тип определяется автоматически.</p><div class="language-JavaScript line-numbers-mode" data-ext="JavaScript"><pre class="language-JavaScript"><code>var myName = &quot;Тим&quot;;
var myAge = 54;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Если посмотреть на пример ниже, то мы увидим, что для объявления переменных в iScript используется другой синтаксис, что является основным отличием от JavaScript.</p><div class="language-iScript line-numbers-mode" data-ext="iScript"><pre class="language-iScript"><code>f.myName = &quot;Тим&quot;;
f.myAge = 54;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Запомните, iScript — это, по сути, JavaScript, а TyranoScript – это язык разметки с возможностью интеграции тегов.</p><h3 id="кликабельные-области-изображения" tabindex="-1"><a class="header-anchor" href="#кликабельные-области-изображения" aria-hidden="true">#</a> Кликабельные области изображения</h3><p>В TyranoBuilder на фоновом изображении можно создать <em>кликабельные области</em>. Например, у вас на изображении есть дверь, по которой выполнив щелчок, игрока перенесёт на другую сцену. Так как кликабельные области не имеют своего изображения они всегда используются в комбинации с компонентом &quot;<em>Background Image (Фоновое Изображение)</em>&quot;.</p><p><img src="/book-game-development-renpy/assets/figure_5_4-0cc7606f.png" alt="Рисунок 5-4. Инструмент позиционирования кликабельной области. В данном случае книжная полка определена как кликабельная область."></p><p><strong>Рисунок 5-4.</strong> Инструмент позиционирования кликабельной области. В данном случае книжная полка определена как кликабельная область.</p><p>Чтобы добавить кликабельную область, перетащите компонент &quot;<em>Clickable Area (Кликабельная область)</em>&quot; под компонент фонового изображения. Далее, в параметрах вызываем инструмент позиционирования (см. Рисунок 5-4), и используя маску, имеющую вид затемнённого прямоугольника, задаём позицию и размер активной области.</p><p>После указания маски задаём параметр &quot;<em>Location (Местоположение)</em>&quot; то есть имя сцены и &quot;<em>Target (Цель)</em>&quot; то есть метку на сцене куда перенесётся игрок при клике по активной области.</p><h3 id="пользовательские-шрифты" tabindex="-1"><a class="header-anchor" href="#пользовательские-шрифты" aria-hidden="true">#</a> Пользовательские шрифты</h3><p>TyranoBuilder по умолчанию имеет в наборе четыре варианта шрифта. Этот список можно расширить, установив дополнительно пользовательские шрифты.</p><p>Основной формат шрифта поддерживаемый в TyranoBuilder – это <em>TrueType (.ttf)</em>. Так как данный формат очень популярный, то соответственно существуют тысячи бесплатных и стильных шрифтов, которые можно скачать, например с: <a href="https://fonts.google.com/" target="_blank" rel="noopener noreferrer">https://fonts.google.com/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, <a href="https://www.fontsquirrel.com/" target="_blank" rel="noopener noreferrer">https://www.fontsquirrel.com/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, <a href="https://www.1001freefonts.com/" target="_blank" rel="noopener noreferrer">https://www.1001freefonts.com/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> или <a href="https://www.dafont.com/" target="_blank" rel="noopener noreferrer">https://www.dafont.com/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>Чтобы установить шрифт в свой проект, выбираем пункт меню &quot;<em>Project\Custom Fonts</em> (<em>Проект\Пользовательские шрифты</em>)&quot;. В появившемся окне нажимаем кнопку &quot;<em>Add Font</em> (<em>Добавить шрифт</em>)&quot;, и указываем файл с расширением .ttf. Теперь, чтобы применился добавленный шрифт, щелкаете по иконке в виде шестерёнки, после чего откроется окно &quot;<em>Game Settings</em> (<em>Настройки игры</em>)&quot;. Далее нужно перейти на вкладку &quot;<em>Font Style</em> (<em>Тиль шрифта</em>)&quot; и в поле &quot;<em>Font Type</em> (<em>Тип шрифта</em>)&quot; выбираем загруженный шрифт, после чего нажимаем кнопку &quot;<em>Apply</em> (<em>Применить</em>)&quot;.</p><p>Для того чтобы назначить другой шрифт для части диалогов вашей игры, необходимо воспользоваться компонентом &quot;<em>Change Font Style</em> (<em>Изменить стиль шрифта</em>)&quot;, который находится на вкладке &quot;<em>Messages</em> (<em>Сообщения</em>)&quot; панели компонентов. Его нужно разместить перед компонентом &quot;<em>Show Text</em> (<em>Показать текст</em>)&quot;, и на панеле параметров указываем шрифт.</p><h2 id="магия-twine" tabindex="-1"><a class="header-anchor" href="#магия-twine" aria-hidden="true">#</a> Магия Twine</h2><p>Несмотря на то, что Twine выглядит так просто, он имеет достаточно мощные инструменты для создания визуального и звукового сопровождения истории. Это достигается благодаря поддержки <em>JavaScript</em> и <em>каскадных таблиц стилей (CSS)</em>.</p><blockquote><p><strong>Примечание:</strong></p><p>Во всех примерах этой части книги будет использоваться формат истории SugarCube.</p></blockquote><p>Как мы уже знаем, Twine имеет разные форматы историй, но у них во всех есть общая особенность это использование HTML тегов. Давайте познакомимся с некоторыми из них (см. Таблицу 5-8).</p><p><strong>Таблица 5-8.</strong> HTML-теги, которые также работают в Twine</p><table><thead><tr><th>HTML-тег</th><th>Описание</th><th>Пример</th></tr></thead><tbody><tr><td><em>&lt;p&gt;</em></td><td>Абзац</td><td>&lt;p&gt;Это абзац&lt;/p&gt;</td></tr><tr><td><em>&lt;br&gt;</em></td><td>Перенос строки</td><td>Строка.&lt;br&gt;Новая строка.</td></tr><tr><td><em>&lt;button&gt;</em></td><td>Создаёт кликабельную кнопку</td><td>&lt;button&gt;Нажмите здесь&lt;/button&gt;</td></tr><tr><td><em>&lt;ul&gt;</em></td><td>Используется для создания маркированного списка, используя тег &lt;li&gt; для каждого пункта.</td><td>&lt;ul&gt;<br>&lt;li&gt;Пункт&lt;/li&gt;<br>&lt;li&gt;Ещё один пункт&lt;/li&gt;<br>&lt;/ul&gt;</td></tr><tr><td><em>&lt;table&gt;</em></td><td>Создает таблицу, используя тег &lt;tr&gt; для указания строки, &lt;th&gt; для указания заголовка и &lt;td&gt; для ячейки таблицы.</td><td>&lt;table&gt;<br> &lt;tr&gt; &lt;th&gt;Имя&lt;/th&gt; &lt;th&gt;Фамилия&lt;/th&gt; &lt;th&gt;Занятие&lt;/th&gt; &lt;/tr&gt;<br> &lt;tr&gt; &lt;td&gt;Ben&lt;/td&gt; &lt;td&gt;Бен&lt;/td&gt; &lt;td&gt;Варвар&lt;/td&gt; &lt;/tr&gt;<br> &lt;tr&gt; &lt;td&gt;Джил&lt;/td&gt; &lt;td&gt;Вордсмит&lt;/td&gt;&lt;td&gt;Шахтер&lt;/td&gt; &lt;/tr&gt;<br> &lt;/table&gt;</td></tr><tr><td><em>&lt;b&gt;</em></td><td>Жирный текст</td><td>Что-то выделено &lt;b&gt;жирным шрифтом&lt;/b&gt;</td></tr><tr><td><em>&lt;i&gt;</em></td><td>Курсивный текст</td><td>&lt;i&gt;Это предложение выделено курсивом&lt;/i&gt;</td></tr><tr><td><em>&lt;u&gt;</em></td><td>Нижнее подчеркивание</td><td>Немного &lt;u&gt;подчеркнутого текста&lt;/u&gt;</td></tr><tr><td><em>&lt;h1&gt;</em></td><td>Заголовок первого уровня, то есть самый большой заголовок</td><td>&lt;h1&gt;Это довольно большой заголовок&lt;/h1&gt;</td></tr><tr><td><em>&lt;h6&gt;</em></td><td>Заголовок шестого уровня, то есть самый маленький заголовок</td><td>&lt;h6&gt;Это сложно прочитать&lt;/h6&gt;</td></tr></tbody></table><h3 id="вызов-javascript-в-twine" tabindex="-1"><a class="header-anchor" href="#вызов-javascript-в-twine" aria-hidden="true">#</a> Вызов JavaScript в Twine</h3><p>Если нужно вставить в параграф простой JavaScript, а история создаётся в формате SugarCube, то достаточно воспользоваться тегом script, как показано в следующем примере.</p><div class="language-JavaScript line-numbers-mode" data-ext="JavaScript"><pre class="language-JavaScript"><code>&lt;&lt;script&gt;&gt; alert(&quot;Посмотри на меня!&quot;); &lt;&lt;/script&gt;&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Но если вам нужно вставить скрипт большего размера, то следует воспользоваться инструментом <em>Story JavaScript</em>, который можно вызвать, нажав на панеле инструментов <em>Story\JavaScript</em>.</p><h3 id="анимация-раскрытия-текста-в-css" tabindex="-1"><a class="header-anchor" href="#анимация-раскрытия-текста-в-css" aria-hidden="true">#</a> Анимация раскрытия текста в CSS</h3><p>Выбрав на панеле инструментов вкладку <em>Story</em> (<em>История</em>) и нажав на <em>Stylesheet</em> (<em>Таблица стилей</em>), откроется редактор стилей &quot;<em>Story Stylesheet</em> (<em>История Таблица стилей</em>)&quot;. Где, используя всю мощь CSS, вы можете задать глобальные стили для игры.</p><p>Ниже приведен пример эффекта раскрытия текста. Классом <em>.css-reveal</em> нужно будет пометить тег, к которому нужно применить плавную анимацию отображения текст слева направо.</p><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token selector">.css-reveal</span>
<span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 30em<span class="token punctuation">;</span>
    <span class="token property">white-space</span><span class="token punctuation">:</span>nowrap<span class="token punctuation">;</span>
    <span class="token property">overflow</span><span class="token punctuation">:</span>hidden<span class="token punctuation">;</span>
    <span class="token property">-webkit-animation</span><span class="token punctuation">:</span> type 5s <span class="token function">steps</span><span class="token punctuation">(</span>75<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">animation</span><span class="token punctuation">:</span> type 5s <span class="token function">steps</span><span class="token punctuation">(</span>75<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token atrule"><span class="token rule">@keyframes</span> type</span><span class="token punctuation">{</span>
    <span class="token selector">from</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token atrule"><span class="token rule">@-webkit-keyframes</span> type</span><span class="token punctuation">{</span>
    <span class="token selector">from</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Чтобы увидеть, как работает эффект нужно добавить в параграф строку, обернутую тегом &lt;p&gt;, с классом <em>css-reveal</em>.</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>css-reveal<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Привет!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Запускаем игру <em>Build\Play</em> (<em>Собрать\Запустить</em>). В результате, после показа параграфа, текст начнёт плавно появляться, как будто печатается печатной машинкой.</p><p>Как видно, использовать CSS очень просто, и он дают возможность не только красиво стилизовать игру, но и добавить анимацию. Не пугайтесь непонятного содержания CSS стилей, со временем вы овладеете этой магией, и научитесь создавать свои уникальные эффекты. Однако в этой книге будут рассмотрены, только те свойства стилей, которые необходимы для реализации демонстрационной версии визуальной новеллы.</p><h3 id="оживляем-текст" tabindex="-1"><a class="header-anchor" href="#оживляем-текст" aria-hidden="true">#</a> Оживляем текст</h3><p>Есть желание украсить вашу историю? Воспользуйтесь нижеприведёнными примерами CSS. Для этого скопируйте и вставьте их в Story\Stylesheet. После чего назначьте данные стили элементам в параграфе. В результате класс .shadow добавить тексту тень, .redglow добавит тексту красное свечение,.upside-down перевернёт текст верх ногами, а класс .mirror отобразит текст зеркально.</p><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token selector">.shadow</span> <span class="token punctuation">{</span>
    <span class="token property">text-shadow</span><span class="token punctuation">:</span> 0.07em 0.07em 0.07em #000<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.redglow</span> <span class="token punctuation">{</span>
    <span class="token property">text-shadow</span><span class="token punctuation">:</span> 0 0 0.2em #F00<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.upside-down</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>-1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">-webkit-transform</span><span class="token punctuation">:</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>-1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.mirror</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleX</span><span class="token punctuation">(</span>-1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">-webkit-transform</span><span class="token punctuation">:</span> <span class="token function">scaleX</span><span class="token punctuation">(</span>-1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Следующий пример CSS создаёт эффект дрожащего текста. Первые два правила устанавливают ключевые кадры для анимации, а сам эффект определяется в классе .shake, который нужно назначить элементу в параграфе.</p><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token atrule"><span class="token rule">@-webkit-keyframes</span> shake</span> <span class="token punctuation">{</span>
    <span class="token selector">50%</span> <span class="token punctuation">{</span>
        <span class="token property">-webkit-transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0.2em<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0.2em<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token atrule"><span class="token rule">@keyframes</span> shake</span> <span class="token punctuation">{</span>
    <span class="token selector">50%</span> <span class="token punctuation">{</span>
        <span class="token property">-webkit-transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0.2em<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0.2em<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token selector">.shake</span> <span class="token punctuation">{</span>
    <span class="token property">-webkit-animation</span><span class="token punctuation">:</span> shake linear 0.1s 0s infinite<span class="token punctuation">;</span>
    <span class="token property">animation</span><span class="token punctuation">:</span> shake linear 0.1s 0s infinite<span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Вот еще один пример правил CSS, который заставляет текст непрерывно исчезать и появляться. Если вы захотите изменить скорость анимации укажите в параметре «4s (4 секунды)» другое значение.</p><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token atrule"><span class="token rule">@-webkit-keyframes</span> fade-in-out</span> <span class="token punctuation">{</span>
    <span class="token selector">0%,
    to</span> <span class="token punctuation">{</span>
        <span class="token property">opacity</span><span class="token punctuation">:</span> 0
    <span class="token punctuation">}</span>
    <span class="token selector">50%</span> <span class="token punctuation">{</span>
        <span class="token property">opacity</span><span class="token punctuation">:</span> 1
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token atrule"><span class="token rule">@keyframes</span> fade-in-out</span> <span class="token punctuation">{</span>
    <span class="token selector">0%, to</span> <span class="token punctuation">{</span>
        <span class="token property">opacity</span><span class="token punctuation">:</span> 0
    <span class="token punctuation">}</span>
    <span class="token selector">50%</span> <span class="token punctuation">{</span>
        <span class="token property">opacity</span><span class="token punctuation">:</span> 1
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token selector">.fade-in-out</span> <span class="token punctuation">{</span>
    <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token property">animation</span><span class="token punctuation">:</span> fade-in-out 4s ease-in-out infinite alternate<span class="token punctuation">;</span>
    <span class="token property">-webkit-animation</span><span class="token punctuation">:</span> fade-in-out 4s ease-in-out infinite alternate<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>В следующем примере, набор правил в стиле позволяет изменять размер текстового слоя. Для этого добавляем стили в Story\Stylesheet:</p><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token selector">.resizable-textbox</span> <span class="token punctuation">{</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 2px solid<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">resize</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span>
    <span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>После чего добавляем элемент в параграф:</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>resizable-textbox<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    First line<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    Second line<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
    Third line
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Запускаем игру.</p><p>Теперь, чтобы изменить размер текстового слоя, нужно мышью потянуть за правый нижний угол.</p><h3 id="знакомимся-с-форматом-истории-harlowe" tabindex="-1"><a class="header-anchor" href="#знакомимся-с-форматом-истории-harlowe" aria-hidden="true">#</a> Знакомимся с форматом истории Harlowe</h3><p>Формат истории SugarCube отлично подходит для создания игр. Но как вы знаете Twine имеет и другие альтернативные форматы, например: <em>Harlowe</em> и <em>Snowman</em>.</p><p>Давайте сначала познакомимся с Harlowe. Для этого создадим новую историю в этом формате.</p><h4 id="harlowe-и-сила-jquery" tabindex="-1"><a class="header-anchor" href="#harlowe-и-сила-jquery" aria-hidden="true">#</a> Harlowe и сила jQuery</h4><p>В Twine есть встроенная библиотека <em>jQuery</em> — это замечательный JavaScript Framework, созданный Джоном Резигом в 2006 году. Данная библиотека предоставляет множество функций для работы с любым элементом в параграфе Twine, что позволяет улучшить визуальный вид игры. Так же с её помощью можно создать анимационные эффекты.</p><p>Давайте познакомимся с основами jQuery.</p><p>Если игра использует формат истории Harlowe, то для интеграции jQuery и JavaScript используется тег &lt;script&gt;. В нижеприведённом примере создаются две кнопки имеющие идентификатор <em>button1</em>, <em>button2</em> и слой виде серого прямоугольника с идентификатором <em>superbox</em>. В свою очередь кнопкам назначается событие клика, которое выполняет анимацию для superbox (серий прямоугольник). Как вы заметили в примере почти все строки начинаются с символа доллара ($) – это и есть библиотека jQuery.</p><p>Запустим игру и проверим как работает пример. Если нажать кнопку под названием &quot;Действие (Action)&quot;, то прямоугольник увеличиться по ширине до 300 пикселей, а если нажать кнопу &quot;Сброса (Reset)&quot;, то прямоугольник вернётся к исходной размеру в 100 пикселей.</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#button1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#superbox&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">&quot;300px&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#button2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#superbox&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">&quot;100px&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Action<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Reset<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>superbox<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">background</span><span class="token punctuation">:</span>#777<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span>100px<span class="token punctuation">;</span> <span class="token property">width</span><span class="token punctuation">:</span>100px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>В предыдущем примере был рассмотрен только один эффект — это <em>animate</em>, но <em>jQuery</em> имеет и другие <em>методы эффектов</em>. Давайте рассмотрим некоторые из них и способы их применения (см. Таблицу 5-9).</p><p><strong>Таблица 5-9.</strong> Методы эффектов в jQuery</p><table><thead><tr><th>Эффект</th><th>Описание</th><th>Пример</th></tr></thead><tbody><tr><td><em>fadeIn</em></td><td>Отображает элемент, увеличивая его прозрачность. Можно указать скорость эффекта &#39;slow&#39;, &#39;fast&#39; или значение в миллисекундах. По умолчанию значение равно &quot;swing&quot;.</td><td>$(&quot;button&quot;).click(function(){<br>$(&quot;#bluebox&quot;).<strong>fadeIn</strong>(&quot;fast&quot;);<br>$(&quot;#redbox&quot;).<strong>fadeIn</strong>(&quot;slow&quot;);<br>});<br>&lt;button&gt;Нажмите!&lt;/button&gt;&lt;br&gt;<br>&lt;div id=&quot;bluebox&quot; style=&quot;width:60px; height:60px; display:none; background-color:red;&quot;&gt;&lt;/div&gt;&lt;br&gt;<br>&lt;div id=&quot;redbox&quot; style=&quot;width:60px; height:60px; display:none; background-color:red;&quot;&gt;&lt;/div&gt;</td></tr><tr><td><em>fadeOut</em></td><td>Скрывает элемент, уменьшая его прозрачность. Имеет те же значения, что и для fadeIn.</td><td>$(&quot;button&quot;).click(function(){<br>$(&quot;#bluebox&quot;).<strong>fadeOut</strong>(1000);<br>$(&quot;#redbox&quot;).<strong>fadeOut</strong>(&quot;fast&quot;);<br>});</td></tr><tr><td><em>slideToggle</em></td><td>Эффекты скольжения позволяют плавно скрыть или раскрыть элемент. Можно указать скорость эффекта &#39;slow&#39;, &#39;fast&#39; или значение в миллисекундах. По умолчанию значение равно &quot;swing&quot;.</td><td>$(document).ready(function(){<br>$(&quot;#button&quot;).click(function(){<br>$(&quot;#panel&quot;).<strong>slideToggle</strong>(2000);<br>});<br>});<br>&lt;style&gt;<br>#panel, #button {<br>padding: 3px;<br>text-align: center;<br>background-color: #red;<br>border: solid 1px #yellow;<br>}<br>#panel {<br>padding: 40px;<br><strong>display: none;</strong><br>}<br>&lt;/style&gt;<br>&lt;div id=&quot;button&quot;&gt;Нажмите здесь&lt;/div&gt;<br>&lt;div id=&quot;panel&quot;&gt;Скрытое послание!&lt;/div&gt;</td></tr></tbody></table><h4 id="больше-об-анимации" tabindex="-1"><a class="header-anchor" href="#больше-об-анимации" aria-hidden="true">#</a> Больше об анимации</h4><p>Давайте вернемся к методу jQuery <em>animate</em>, с которым мы познакомились ранее в этой главе. Данный метод способен на гораздо большее, нежели просто изменять ширину элемента, а именно, анимировать сразу несколько атрибутов одновременно. Следующий код, наглядно это показывает. После запуска игры, следите, как изменится слой <em>happybox</em>.</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">.happybox</span> <span class="token punctuation">{</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
        <span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
        <span class="token property">margin-top</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
        <span class="token property">border-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span>
        <span class="token property">border-color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;.happybox&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">&quot;200px&quot;</span><span class="token punctuation">,</span> 
                <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">&quot;200px&quot;</span><span class="token punctuation">,</span> 
                <span class="token literal-property property">marginLeft</span><span class="token operator">:</span> <span class="token string">&quot;30px&quot;</span><span class="token punctuation">,</span> 
                <span class="token literal-property property">borderWidth</span><span class="token operator">:</span> <span class="token string">&quot;10px&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Посмотри на меня!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>happybox<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="знакомимся-с-snowman" tabindex="-1"><a class="header-anchor" href="#знакомимся-с-snowman" aria-hidden="true">#</a> Знакомимся с Snowman</h3><p>Формат истории &quot;<em>Snowman</em> (<em>Снеговик</em>)&quot; имеет очень простой подход для создания игр в Twine, и использует язык разметки <em>Markdown</em>. Данный язык, созданный <em>Джоном Грубером</em>, основан на использовании минимального количества специальных символов для форматирования текста (см. пример ниже).</p><div class="language-Markdown line-numbers-mode" data-ext="Markdown"><pre class="language-Markdown"><code># Header1
## Header2
### Header3
#### Header4
##### Header5
###### Header6
*Emphasized*
**Bold**
~~Deletion~~
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>После вставки данного кода в параграф Snowman мы получим результат, как показан на рисунке 5-6.</p><p><img src="/book-game-development-renpy/assets/figure_5_5-eb345c46.png" alt="Рисунок 5-5. Пример форматирования текста в формате истории &quot;Snowman&quot;"></p><p><strong>Рисунок 5-5.</strong> Пример форматирования текста в формате истории &quot;Snowman&quot;</p><h4 id="snowman-javascript-и-underscore" tabindex="-1"><a class="header-anchor" href="#snowman-javascript-и-underscore" aria-hidden="true">#</a> Snowman, JavaScript и Underscore</h4><p>Формат истории «Snowman» был разработан с учётом поддержки JavaScript и CSS, поэтому в нем нет макросов как в SugarCube и Harlowe.</p><p>Так же Snowman включает в себя библиотеку <em>Underscore</em>, содержащая в себя довольно много продвинутых методов сортировки и обработки данных.</p><p>Чтобы интегрировать JavaScript и Underscore используются теги <em>&lt;%</em> и <em>%&gt;</em>, а для вывода данных используются теги <em>&lt;%=</em> и <em>%&gt;</em>. Пример использования данных тегов показан ниже.</p><div class="language-Markdown line-numbers-mode" data-ext="Markdown"><pre class="language-Markdown"><code>&lt;% alert( &#39;Привет, мир!&#39; ); %&gt;
Интересно, сколько будет 1+2? Это будет &lt;%= 1+2 %&gt;.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="snowman-и-переменные" tabindex="-1"><a class="header-anchor" href="#snowman-и-переменные" aria-hidden="true">#</a> Snowman и переменные</h4><p>В этом формате истории переменные определяются при помощи глобальной переменной с именем <em>s</em>.</p><div class="language-Markdown line-numbers-mode" data-ext="Markdown"><pre class="language-Markdown"><code>&lt;%
     s.myAge = 52;
     s.myName = &quot;Джимми&quot;;
%&gt;
Привет, меня зовут &lt;%= s.myName %&gt; и мне &lt;%= s.myAge %&gt;!
&lt;% ++s.myAge %&gt;
Постойте. На самом деле мне &lt;%= s.myAge %&gt;.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="бросаем-кубик-в-snowman" tabindex="-1"><a class="header-anchor" href="#бросаем-кубик-в-snowman" aria-hidden="true">#</a> Бросаем кубик в Snowman</h4><p>Теперь, давайте сделаем что-то практическое, например бросание игровых костей. Для получения случайного значения будем использовать метод <em>_.random</em> из библиотеки Underscore, где символ нижнее подчеркивание (т. е. _) и есть вызов самой библиотеки.</p><div class="language-Markdown line-numbers-mode" data-ext="Markdown"><pre class="language-Markdown"><code>Бросаем четырёхгранный кубик: &lt;%= _.random(1,4) %&gt;&lt;br&gt;
Бросаем шестигранный кубик: &lt;%= _.random(1,6) %&gt;&lt;br&gt;
На самом деле мой реальный возраст &lt;%= s.myAge=_.random(53,100) %&gt; лет. 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Как видим в примере, метод _.random принимает два параметра для указания диапазона выборки случайного значения для бросаемого кубика, а в последней строке примера мы присваиваем ранее определённой переменной myAge случайное значение от 53 до 100.</p><h4 id="underscore-и-массивы" tabindex="-1"><a class="header-anchor" href="#underscore-и-массивы" aria-hidden="true">#</a> Underscore и массивы</h4><p>Давайте более ближе познакомимся с библиотекой Underscore, которая предлагает немало дополнительных функций. Во-первых, библиотека имеет много методов для работы с <em>массивом</em>. Что может пригодиться, например для создания инвентаря в вашей игре.</p><p>Пример создания массива:</p><div class="language-Markdown line-numbers-mode" data-ext="Markdown"><pre class="language-Markdown"><code>&lt;% var Friends = []; %&gt;
&lt;% var Items = [&quot;Меч&quot;,&quot;Банан&quot;,&quot;Шляпа&quot;]; %&gt;&lt;br&gt;
Ваш инвентарь: &lt;%= Items %&gt;&lt;br&gt;
&lt;% Items.pop() %&gt;
Черт возьми, кажется, ты потерял свою шляпу!&lt;br&gt;&lt;br&gt;
Ваш инвентарь: &lt;%= Items %&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Первая строка создает пустой массив под названием &quot;<em>Friends</em> (<em>Друзья</em>)&quot;. На второй строке создается массив с именем &quot;<em>Items</em> (<em>Предметы</em>)&quot;, которому присваивается список, состоящий из трёх предметов, а третья строка просто выводит содержимое этого массива на экран.</p><p>В четвёртой строке при помощи JavaScript метода <em>pop</em> удаляем последний элемент массива. Если вам нужно добавить новые элементы в массив используйте метод push, как показано в примере <em>&lt;% Items.push(&quot;Новая шляпа&quot;, &quot;Апельсин&quot;); %&gt;</em>.</p><p>Теперь давайте познакомимся с наиболее полезными методами библиотеки Underscore (см. Таблицу 5-10).</p><p><strong>Таблица 5-10.</strong> Методы библиотеки Underscore для работы с массивами</p><table><thead><tr><th>Метод</th><th>Описание</th><th>Пример</th></tr></thead><tbody><tr><td>_<em>.find</em></td><td>Просматривает каждое значение в массиве, пока не найдет первое, прошедшее проверку на истинность</td><td>&lt;% var DiscoverFedora = <strong>_.find</strong>([&quot;Шляпа&quot;,&quot;Банан&quot;, &quot;Шляпа&quot;], function(string){ return string == &quot;Шляпа&quot;; }); %&gt;<br>&lt;%= DiscoverFedora %&gt;</td></tr><tr><td>_<em>.last</em></td><td>Возвращает последний элемент массива</td><td>&lt;% var Items = [&quot;Меч&quot;, &quot;Банан&quot;, &quot;Шляпа&quot;]; %&gt;<br>&lt;% var Inventory = <strong>_.last(Items)</strong>; %&gt;<br>&lt;%= Inventory %&gt;</td></tr><tr><td>_<em>.first</em></td><td>Возвращает первый элемент массива</td><td>&lt;% var Items = [&quot;Меч&quot;, &quot;Банан&quot;, &quot;Шляпа&quot;]; %&gt;<br>&lt;% var Inventory = <strong>_.first(Items)</strong>; %&gt;<br>&lt;%= Inventory %&gt;</td></tr><tr><td>_<em>.each</em></td><td>Перебирает массив, вызывая для каждого элемента функцию, которая принимает три аргумента элемент, индекс, список</td><td>&lt;% var Items = [&quot;Меч&quot;, &quot;Банан&quot;, &quot;Шляпа&quot;]; %&gt;<br>&lt;% <strong>_.each(Items, function(value, index, list)</strong> { %&gt;<br>&lt;%= index + &quot;: &quot; + value+&quot;&lt;br&gt;&quot; %&gt;<br>&lt;%= &quot;Полный список: &quot;+list %&gt;<br>&lt;% }); %&gt;</td></tr><tr><td>_<em>.map</em></td><td>Создает новый массив значений путем сопоставления каждого значения в списке с помощью функции преобразования</td><td>Исходные значения: 1, 4 и 5<br>&lt;% var <strong>Example = _.map([1, 4, 5], function(num){ return num * 5; });</strong> %&gt;<br>В результате получим каждый элемент умноженный на пять: &lt;%= Example %&gt;</td></tr><tr><td>_<em>.sample</em></td><td>Производит случайную выборку из массива. Принимает значение, какое количество элементов вернуть из массива. В противном случае будет возвращен один случайный элемент</td><td>&lt;% var Items = [&quot;Меч&quot;, &quot;Банан&quot;, &quot;Шляпа&quot;]; %&gt;<br>&lt;% var Sampling = <strong>_.sample(Items, 2)</strong> %&gt;<br>&lt;%= Sampling %&gt;</td></tr><tr><td>_<em>.size</em></td><td>Возвращает количество элементов в массиве</td><td>&lt;% var Items = [&quot;Меч&quot;, &quot;Банан&quot;, &quot;Шляпа&quot;]; %&gt;<br>&lt;% var Size = <strong>_.size(Items)</strong> %&gt;&lt;%= Size %&gt;</td></tr><tr><td>_<em>.clone</em></td><td>Клонирует массив</td><td>&lt;% var Items = [&quot;Меч&quot;, &quot;Банан&quot;, &quot;Шляпа&quot;]; %&gt;<br>&lt;% var Cloned = <strong>_.clone(Items);</strong> %&gt;<br>&lt;%= Cloned %&gt;</td></tr><tr><td>_<em>.filter</em></td><td>Просматривает каждое значение в массиве, возвращая массив значений, прошедших проверку.</td><td>&lt;% var Filtered = <strong>_.filter([&quot;Меч&quot;, &quot;Банан&quot;, &quot;Шляпа&quot;]</strong>, function(string) { return string == &quot;Банан&quot; }); %&gt;<br>&lt;%= Filtered %&gt;</td></tr></tbody></table><h4 id="snowman-и-аудиовизуал" tabindex="-1"><a class="header-anchor" href="#snowman-и-аудиовизуал" aria-hidden="true">#</a> Snowman и аудиовизуал</h4><p>Поскольку Snowman не включает в себя макросы, то аудиовизуальные элементы в игру добавляются при помощи HTML и JavaScript. Соответственно, чтобы добавить изображение и аудиофайл нам нужно написать следующие строки:</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Вот изображение:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://upload.wikimedia.org/wikipedia/commons/6/6e/Napoleon_crop.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>50%<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>50%<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>А теперь ещё и аудио!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>audio</span> <span class="token attr-name">controls</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://upload.wikimedia.org/wikipedia/commons/b/b4/United_States_Navy_Band_-_O_Canada.ogg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>audio/ogg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>audio</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Что касается jQuery с его визуальными возможностями, то он так же используется и в Snowman.</p><h2 id="заключение" tabindex="-1"><a class="header-anchor" href="#заключение" aria-hidden="true">#</a> Заключение</h2><p>В этой главе было предоставлено много информации о Ren’Py, TyranoBuilder и Twine.</p><p>Про Ren’Py:</p><ul><li>Как работать с видео</li><li>Воспроизвести звук, настроить вывод изображения и как добавить переходы</li><li>Как настроить графический интерфейс при помощи файла конфигурации</li></ul><p>Про TyranoBuilder:</p><ul><li>Что такое плагины и как они интегрируются</li><li>Как создать случайный диалог и использовать пользовательские шрифты</li><li>Как работать с переменными и как их использовать в сценарии</li></ul><p>Про Twine:</p><ul><li>Какие различия между форматами историй SugarCube, Harlowe и Snowman</li><li>Как использовать каскадные таблицы стилей (CSS)</li><li>Какие основные элементы HTML используются для создания игр</li><li>Как работать с JavaScript библиотеками jQuery и Underscore.</li></ul><p>В следующей главе мы рассмотрим, как развернуть игры созданные в Ren’Py, TyranoBuilder и Twine на различных платформах.</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/book-game-development-renpy/chapter_4.html" class="" aria-label="Глава 4. Знакомимся с Ren’Py, Twine и TyranoBuilder"><!--[--><!--]--> Глава 4. Знакомимся с Ren’Py, Twine и TyranoBuilder <!--[--><!--]--></a></span><span class="next"><a href="/book-game-development-renpy/chapter_6.html" class="" aria-label="Глава 6. Запускаем на популярных платформах"><!--[--><!--]--> Глава 6. Запускаем на популярных платформах <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/book-game-development-renpy/assets/app-e2a8f75c.js" defer></script>
  </body>
</html>
