# Глава 4. Знакомимся с Ren’Py, Twine и TyranoBuilder

В этой главе мы рассмотрим три инструмента для создания визуальных новелл: Ren’Py, Twine и TyranoBuilder. Хотя основное 
внимание в этой книге отдано Ren’Py, но также будет уделено достаточно времени и к двум другим движкам, чтобы 
познакомится с их пользовательскими интерфейсами, основными возможностями, и с подходами к разработке визуальных новелл. 

Примеры в данной главе будут простыми, а в следующих главах мы рассмотрим более продвинутые методы разработки в виде 
трех мини-приключений. 

И начнём мы с сравнением характеристик этих движков (см. таблицу 4-1).

__Таблица 4-1.__ Сравнительная таблица Ren’Py, Twine и TyranoBuilder

| Инструмент      | Лицензия   | Поддержка ОС                               | Разработка на ОС              | Лучше всего подходит для                                                                                                |
| --------------- | ---------- | ------------------------------------------ | ----------------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| _Ren’Py_        | Свободная  | Windows, macOS, Linux, iOS, Android        | Windows, macOS, Linux         | Визуальных новелл                                                                                                       |
| _Twine_         | Свободная  | Windows, macOS, iOS, Android, Linux, HTML5 | Windows, macOS, Linux, online | Минималистической интерактивной художественной литературы с поддержкой визуальных элементов на основе CSS и JavaScript. |
| _TyranoBuilder_ | $15 (2023) | Windows, macOS, iOS, Android               | Windows, macOS                | Визуальных новелл с продвинутой анимацией персонажей с использованием технологии Live2D                                 |

## Ren'Py в деталях

Ren’Py — это мощный инструмент, разработанный исключительно для написания визуальных новелл, а благодаря языку 
программирования Python позволяет создать более сложные игры. Данное программное обеспечение распространяется 
бесплатно, и его можно скачать по ссылке: [https://www.renpy.org/](https://www.renpy.org/). 

Данный игровой движок позволяет создавать как некоммерческие, так и коммерческие игры для разных платформ. Самые 
успешные созданные визуальные новеллы это _Doki Doki Literature Club!_ и _Digital: A Love Story_. Кроме того, Ren’Py 
имеет огромное сообщество разработчиков и не мало активных форумов. Так же Ren’Py поддерживает большинство популярных 
форматов изображений и аудио.

Выйдя в 2004 году, Ren'Py по-прежнему остается популярным инструментом для разработки визуальных новелл, а регулярно 
выходящие новые версии движка говорит о том, что проект активно развивается.

### Как работает Ren'Py

Ren’Py можно разделить на три компонента: лаунчер (см. рис. 4-1), файлы сценариев и аудиовизуальные элементы (то есть 
изображения и аудиофайлы). Лаунчер — это, по сути, менеджер проектов, который позволяет вам создавать и управлять 
игровыми проектами, над которыми вы работаеете.

![Рисунок 4-1. Лаунчер Ren’Py](./img/chapter_4/figure_4_1.png)

__Рисунок 4-1.__ Лаунчер Ren’Py

Все файлы сценариев в Ren’Py имеют расширение _.rpy_ (например: _script.rpy_). Это обычный текстовый файлы, который 
можно редактировать в любом текстовом редакторе, но сам Ren'Py не имеет встроенного редактора для работы с файлами со 
скриптами.  Однако, на сайте Ren’Py присутствует список рекомендуемых бесплатных текстовых редакторов.

### Создание нового проекта

Чтобы создать проект нужно на панели лаунчера нажать «Добавить новый проект». Появиться окно, где нужно выбрать 
каталог, в котором будут сохранены все файлы игры. На следующем шаге вам будет предложено указать название проекта. 

Далее вам нужно выбрать расширение экрана. По умолчанию предлагаются следующие расширения 1280x720 (HD), 
1920x1080 (Full HD), 2560x1440 (Quad HD), 3840x2160 (4K) или «Своё». Выбор обычно зависит от размера используемой 
графики в художественном произведении. Естественно, лучше подобрать оптимальный масштаб изображений для проекта. 
Например, на данный момент самым распространённым расширение мониторов является 1920x1080 (Full HD), в результате на 
мониторах 1280x720 игра будет выглядеть отлично, но хуже на мониторах с большими расширениями. Так же игры с указанным 
расширением способны запуститься на более старых компьютерах, поскольку такие проекты не требовательны к 
характеристикам оборудования, по с сравнением 3D играми.

В конце вам будет предложено выбрать цветовую схему для игры. Выбирайте ту, которая лучше всего соответствует вашему 
проекту, её можно будет изменить позже если это потребуется. После это будет создан проекта, который появиться в списке 
проектов лаунчера. 

Для запуска игры достаточно нажать «Запустить проект».

### Функционал Ren'Py

Лаунчер выступает основным инструментов для управления проектами в Ren'Py. Хотя доступ к директории и файлам проекта 
можно получить через обыкновенный проводник или файловый менеджер, но удобней это будет делать через лаунчер. Давайте 
познакомимся с его основными возможностями (см. таблицу 4-2).

__Таблица 4-2.__ Возможности лаунчера Ren'Py

| Действие                   | Описание                                                                                                                           | Используется для                                                                                                     |
| -------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| _Навигация по сценарию_    | Позволяет быстро находить файлы и другие элементы в вашем проекте                                                                  | Позволяет добавить файл сценария                                                                                     |
| _Проверить скрипт (Lint)_  | Запускает Lint, чтобы проверить игровые скрипты на содержание ошибок                                                               | Желательно запускать, каждый раз перед сборкой вашего проекта                                                        |
| _Изменить/Обновить GUI_    | Позволяет изменить цветовую схему пользовательского интерфейса                                                                     | Используется, когда меняется дизайн визуальной новеллы                                                               |
| _Очистить постоянные_      | Удаляет сохранения и другие временные данные игр                                                                                   | Тестирование игры с нуля                                                                                             |
| _Перекомпилировать проект_ | Перекомпилирует все файлы скриптов в проекте                                                                                       | Используется для устранения дефектов в скомпилированных скриптах или импорта проекта из старой версии Ren’Py в новую |
| _Построить дистрибутивы_   | Создает исполняемый файл игры (например, для ПК, macOS, Linux)                                                                     | Используется для распространения игр на указанных вами платформах                                                    |
| _Android_                  | Запускает процесс экспорта проекта на Android, при помощи установленного бесплатного инструмент Ren’Py для упаковки Android (RAPT) | Позволяет выпустить визуальную новеллу для платформы Android                                                         |
| _iOS_                      | Запускает процесс экспорта проекта для iOS путем установки бесплатного инструмента Renios                                          | Позволяет выпустить визуальную новеллу для платформы iOS (iPad, iPhone)                                              |
| _Создать переводы_         | Создает переводы текстов в игре на другие языки                                                                                    | Используется, когда возникает необходимость выпустить игру на дополнительных рынках                                  |
| _Извлечь диалог_           | Экспорт внутри игровых диалогов (или другого текста) в текстовых файл или в файл электронной таблицы                               | Позволяет корректорам и другим членам команды прочитать материал, не играя в игру                                    |

Как видно, Ren’Py довольно многофункционален. Сперва он может показаться сложным для новичка, но после ознакомления с 
основными принципами работы программы, придёт понимание, что они не так уже и сложны. Со временем имея достаточно 
мотивации, вы научитесь использовать мультиязычность и собирать проект для Android.

### Основы в написания сценариев на Ren’Py

Ren’Py имеет гибкий и простой язык сценариев, с которым мы сейчас познакомимся на основе приведённого ниже простого 
примера.

> **Примечание:** 
> 
> Имена файлов с изображениями персонажей должны быть короткие и понятные к каким героям они относятся. Например, в 
> нашем небольшом скрипте изображение Маркуса имеет название mar.png, то есть оно сокращено, и соответствует имени 
> определённое в скрипте. Также файлы должны быть помещены в каталог с изображениями вашего 
> проекта.

``` python
init:
    $ mar = Character('Маркус')
    image home = Image("home_of_markus.jpg")
    image markus happy = Image("markus_happy.png")
    image markus sad = Image("markus_sad.png")
label start:
    scene home
    show markus happy
    mar "Вот я дома и счастлив!"
    hide markus happy
    show markus sad
    mar "Но похоже молоко закончилось."
    "Маркус явно расстроился из-за отсутствия молока."
    hide markus happy
    show mar
    mar "Не поздно ли идти в продуктовый магазин?"
```

Как видим скрипт начинается с оператора инициализации _init:_, где мы задаем изображения для фона и персонажей. 
В наведённом примере, изображение _home_of_markus.jpg_ связано с переменной _home_. Всякий раз, когда нужно показать, 
что наш герой находится дома достаточно вызвать переменную под именем home, вместо длинного имени 
файла _home_of_markus.jpg_.

Аналогично, когда нам нужно изобразить эмоциональное состояние Маркуса, например, грустного или счастливого, мы 
соответственно задаём переменные, которым присваиваем изображения грустного и счастливого Маркуса, и чтобы показать 
счастливого главного героя нужно написать команду "show markus happy". Это позволяет не использовать длинные имена 
файлов, сократить код, держать его чистым и понятным для чтения. Вы можете применять другие эмоции, так как Ren’Py не 
имеет на них ограничения.

Одним из основным оператором в Ren’Py являются метки, которые позволяют выполнить переход по сценарию игры или 
используются для создания меню выбора. То есть по сути метки можно сравнить с понятием сцены, которые могут меняться 
по ходу игры. В нашем примере, игра начинается с метки _label start:_. Так как сценарий простой в нем нет других меток 
или вариантов выбора, пользователь просто щелкает, переходя от одного диалога к другому. Имена меток могут быть любые, 
например, _label work:_ или _label holiday:_.

После метки _start:_ идет оператор по выводу фона и изображения счастливого Маркуса. Далее выводится текст 
"Вот я дома и счастлив!", _помеченный оператором символа_ (_character definition statement_) mar, который был 
инициализирован в разделе _init:_ командой _Character('Маркус')_. Простыми словами, мы создали героя _Маркус_ и 
связываем все его диалоги при помощи переменной mar.

Далее мы рассмотрим некоторые основные элементы языка Ren'Py в таблице 4-3.

__Таблица 4-3.__ Ключевые элементы языка Ren’Py

| Элемент/Объявление | Описание                                                                                                                                        | Пример использования                                                                |
| ------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------|
| init:              | Метка инициализации. Используется для объявления псевдонимов имен файлов и других постоянных данных. Обычно используется для изображений.       | init:<br> image garage = Image("garage.jpg")                                        |
| image              | Используется для определения псевдонимов для файлов изображений.                                                                                | image billy happy = Image("billy.jpg")<br>  image billy angry = Image("billy2.jpg") |
| label              | Используется для создания метки перехода по сценарию игры.                                                                                      | label garage:<br> "We're in the garage!"                                            |
| _Макрос персонажа_ | Используется для создания короткого псевдонима игровому персонажу.                                                                              | $ b = Character('Billy')<br> $ c = Character('Christopher')                         |
| scene              | Удаляет все отображаемые объекты с экрана перед вызовом новых.                                                                                  | scene garage                                                                        |
| show               | Показывает изображение персонажа. Так же можно указывать дополнительное описание, например, «Джеймс счастлив» или «Джеймс злой».                | show billy happy                                                                    |
| hide               | Скрывает изображение персонажа.                                                                                                                 | hide billy happy                                                                    |
| _Произнести фразу_ | Выводит текст на экран или выводит текст принадлежащий персонажу назначенный с помощью макроса персонажей.                                      | "Стояла тишина."<br> b "Кристофер! Ты здесь?"<br> c "Да, Билли. Я здесь."           |
| _Переходы_         | Для мягкого появления изображений в сцене используются переходы, например, затухание или растворение. Вызывается эти эффекты оператором _with_. | show billy angry<br> with fade<br> hide billy angry<br> with dissolve               |
| play sound         | Воспроизводит звуковой файл.                                                                                                                    | play sound "soundfx1.ogg"                                                           |
| pause              | Ставит игру на паузу до щелчка мыши. Если указано число, пауза закончится через указанное количество секунд.                                    | pause 2.0                                                                           |

### Взаимодействуем с пользователем: Меню

Хотя существует жанр _кинетическая новелла_ - это визуальная новела с линейным сюжетом, неплохо бы было дать игроку 
возможность выбора в истории. Для этого используется такой элемент как _menu_, которое состоит из меток и команд 
перехода _jump_. Пример использования показан в сценарии приведённый ниже.

Так же обратите внимание, как в примере используются псевдонимы, которые ссылаются на Кристофера _(c)_ и Билли _(b)_ 
рассматриваемые в предыдущей главе.

``` python 
b "Эй, Кристофер, пошли на улицу?"
pause 2.0

menu:
    "Да. Давай.":
        jump outsideworld
    "Нет. Хочу остаться здесь.":
        jump stayput

label outsideworld:
    c "О. А здесь так свежо!"
    jump endstory

label stayput:
     c "Гараж - *это* прекрасное место."
     jump endstory

label endstory:
     "Конец истории."
     play sound "fanfare.ogg"
```

### Отступы и текстовые блоки 

Одной из наиболее распространенной причиной ошибок в Ren’Py является неправильное соблюдение отступов. Язык очень 
чувствителен к пробелам до такой степени, что скрипт может просто не запуститься. Благодаря отступам, состоящих из 
четырех пробелов, скрипт делиться на логические блоки, как это показано в следующем примере.

``` python 
"Это предложение является частью первого блока."

if True:

    "Это предложение является частью второго блока."

    "Да, это предложение также является частью второго блока."

    "Я думаю вы догадались? Это предложение тоже относится ко второму блоку."

"И вот мы снова вернулись к первому блоку."
```

Как видим операторы первого блока не содержит отступов, однако они есть во втором блоке. Если перед каким-либо 
оператором во втором блоке будет стоять другое количество пробелов, то программа отнесет оператор в новый блок или 
запутается в логике скрипта и выдаст сообщение об ошибке.

### Условные операторы: if, elif, else

В предыдущем сценарии мы встретили такой элемент как _if_ - _условный оператор_, который используются для проверки 
состояния переменных. Сами переменные — это «именованное хранилище» для данных внутри игры, например, таких как 
количество жизней персонажа или других данных. Давайте рассмотрим условный оператор более подробно в следующем сценарии.

``` python 
# Создадим переменную с именем energy и присвоим ей случайное значение от 40 до 100.
# Мы могли бы просто использовать что-то вроде "$ energy = 100",
# но мы сделаем по-другому.
$ energy = renpy.random.randint(40, 100)
if energy >= 100:

   b "Уровень вашей энергии оптимален!"

elif energy >= 50:

   b "Уровень вашей энергии приемлем."

else:

   b "Уровень вашей энергии на исходе."
   play sound "klaxon.ogg"
   pause 4.0
```

В примере при помощи условного оператора _if_ мы сравнивали переменную _energy_. Если переменная energy имеет 
значение 100 или больше, мы выводим сообщение восторга и одобрения. Далее идет оператор elif - это сокращение от 
_else if_. Эта часть программы выполняется, если energy больше или равна 50, но меньше 100, а после _оператор else_ 
выполняется часть программы, если energy падает ниже 50.

После указания условного оператора соблюдая правила отступов, вы можете указывать не ограниченное количество текста и 
команд, как это показано в примере. После оператора else выводится диалоговый текст, далее проиграется звук, и игра 
приостанавливается на 4 секунды.

### Подробней об операторе управления

Использование меток и команд перехода — это не единственный способ управления сценариями Ren’Py. Другая полезная 
конструкция состоит из команд _label_, _call_ и _return_. Их использование продемонстрировано в сценарии ниже.

``` python 
c "Давайте выпьем немного газировки."

call drink_soda

c "Так мы выпили всю газировку."

return

label drink_soda:
    c "Мм. Вкусно, не так ли?"
    return
```

Данный пример выведет следующий текст: «Давайте выпьем немного газировки. Ммм... Вкусно, не так ли? Так мы выпили всю 
газировку». Используя команду call, мы переходим к метке drink_soda, после которой при помощи команды return снова 
возвращаемся в то же место сценария откуда был выполнен переход. Это позволяет вам повторно использовать повторяющиеся 
части кода. Однако если выполнить оператор return перед меткой _drink_soda_, то мы покинем основной сценарий и выйдем 
из игры попав в главное меню.

## Twine в деталях

> **Примечание:** 
> 
> На данный момент Twine имеет версию 2.6.2, которую и будем рассматривать в этой книге.

Twine — прекрасный интуитивно понятный инструмент для создания игр с минималистическим интерфейсом. Его можно скачать 
с официального сайта: www.twinery.org или открыть в браузере по адресу: https://twinery.org/2 .

После установки и запуска Twine (см. рис. 4-2) мы увидим интерфейс состоящий из панели инструментов и из списка ранее 
сохраненных историй. Если его сравнить с Ren’Py, то Twine выглядит проще.

![Рисунок 4-2. Интерфейс Twine](./img/chapter_4/figure_4_2.png)

__Рисунок 4-1.__ Интерфейс Twine

Чтобы создать новый проект на вкладке Story нужно нажать «+ New». В диалоговом окне нужно задать название игры, после 
чего вас перебросит на главный экран редактора.

Основной элемент в Twine - это _параграфы_ (_passages_). После создания нового проекта, по умолчанию в виде квадрата с 
названием создается стартовый параграф. При двойном клике на нем, откроется редактор, где нужно описать локацию/комнату, 
с которого игрок начнет свое путешествие. Давайте напишем что-то простое, например: «Билли точно понравится полететь 
на воздушном шаре!»

### Связываем параграфы переходами
