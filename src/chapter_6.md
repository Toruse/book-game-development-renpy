# Глава 6. Запускаем на популярных платформах

Рассматриваемое программное обеспечение в этой книге не только многофункциональное и удобное, но и имеет возможность 
запускаться на разных платформах. Как это сделать мы подробно рассмотрим в этой главе.

## Ren’Py и персональные компьютеры

Ren’Py "из коробки" развертывается на Windows, macOS и Linux без каких-либо настроек. Для этого на лаунчере Ren’Py в 
разделе _"Действия с проектом"_ выберите _"Построить дистрибутивы"_. Далее указываете для каких платформ вы хотите 
собрать игру и нажимаете _"Построить"_. В таблице 6-1 указан список вариантов сборки и для чего они предназначены.

__Таблица 6-1.__ Варианты сборки игры для персональных операционных систем в Ren’Py

| Вариант                           | Описание                                                                                                                                               |
|-----------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|
| _PC: Windows and Linux_           | Создаст zip-файл для 32-разрядных и 64-разрядных версий Windows и Linux.                                                                               |
| _Linux_                           | Создаст TAR.BZ2 файл для 32- и 64-разрядной версии Linux                                                                                               |
| _Macintosh_                       | Создаст zip-файл для macOS на базе процессора Intel и Apple Silicon                                                                                    |
| _Windows_                         | Создает zip-файл для 32- и 64-битной версии операционный системы Windows                                                                               |
| _Windows, Mac, Linux for Markets_ | Создаст файлы для Windows, macOS и Linux, необходимые для онлайн-распространения через Itch.io и Steam. Эти файлы не предназначены для прямого запуска |

### Минимальные системные требования

Игры созданные на основе Ren’Py в основном не требовательны к ресурсам компьютерной системы, но всё же имеют 
определённые минимальный требования (см. Таблицу 6-2). Однако, параметры могут измениться, например, если в игре 
использовать видео высокого разрешения, для которого потребуется значительно больше ресурсов компьютера.

На данный момент любой средний компьютер способен запустить любую игру созданную на Ren’Py, а это 4 гигабайта (ГБ) 
системной памяти (т. е. ОЗУ) и хороший двухъядерный процессор, но могут быть и исключения.

Так как для визуализации Ren’Py использует _OpenGL_ и _DirectX_, соответственно видеокарта должна поддерживать, как 
минимум OpenGL 3.0 или DirectX 11. Следовательно, нужно учитывать и версию операционной системы — это _Windows 7_ и выше.

__Таблица 6-2.__ Минимальные требования для игр на Ren’Py

| Платформа | Версия ОС           | Процессор                            | ОЗУ    | Графика                   |
|-----------|---------------------|--------------------------------------|--------|---------------------------|
| _Windows_ | 7 и выше            | 2,0 ГГц, 64-битный Intel-совместимый | 2.0 ГБ | OpenGL 3.0 или DirectX 11 |
| _macOS_   | 10.10 и выше        | 2,0 ГГц, 64-битный Intel-совместимый | 2.0 ГБ | OpenGL 3.0                |
| _Linux_   | Ubuntu 16.04 и выше | 2,0 ГГц, 64-битный Intel-совместимый | 2.0 ГБ | OpenGL 3.0                |

Что касается требования к объёму жёсткого диска, то он зависит от размера вашей игры. Если использовать изображения, 
аудио и видео очень высокого качества, соответственно и игра будет расти в размерах. Однако, необходимо найти 
компромисс между размером и качеством медиа файлов, чтобы игра получилась качественной и занимала как можно меньший 
размер на жестком диске.

### Иконки для персонального компьютера

Чтобы задать значок для игры, поместите файл с расширением icon.ico для Windows и icon.icns для macOS в корневую папку 
игры. Если ваша иконка сохранена в PNG формате, то её нужно преобразовать в формат иконки, простое переименования файла 
здесь не подойдет. В Интернете имеется множество бесплатных онлайн-сервисов для такой операции.

## Ren’Py для мобильных устройств

Помимо поддержки персональных компьютеров, Ren’Py может собрать игру для мобильных устройств на базе iOS и Android. 
Однако данный процесс более сложнее и будет подробно рассмотрен в дальнейших главах.

### Развертываем на Android-е

Ren’Py поддерживает сборку игр для Android. Однако могут появиться не предсказуемые баги, и как следствие игры для этой 
операционной системы нужно тестировать более тщательно.

Первым шагом для отладки игры на Android является загрузка и установка _Ren’Py Android Packaging Tool (RAPT)_. Для этого 
на лаунчере нажмите _Android_ в разделе «Действия с проектом», после чего вам будет предложено загрузить вышеупомянутый 
инструмент, если он ещё не был установлен.

Так же вам понадобится _Java Development Kit_. Ссылку для скачивания можно найти в официальной документации. На данный 
момент URL-адрес такой: [https://adoptopenjdk.net/releases.html?variant=openjdk8&jvmVariant=hotspot](https://adoptopenjdk.net/releases.html?variant=openjdk8&jvmVariant=hotspot).

Теперь нужно настроить компьютер и Android для запуска и отладки игры на устройстве:

1. На Android устройстве откройте _"Настройки\Параметры разработчика"_ и включите _**отладку по USB**_.
2. **Настройте соединение Android Debug Bridge (ADB)** между устройством и персональным компьютером. Для этого 
подключите устройство к компьютеру, чтобы установить драйвер. MacOS это сделает автоматически. В Linux нужно загрузить 
пакет выполнив команду _apt-get install adb_. Что касается Windows, следуя инструкции: 
[https://developer.android.com/studio/run/oem-usb](https://developer.android.com/studio/run/oem-usb), загрузите и 
установите USB-драйвер.
3. Далее **устанавливаем SDK** зайдя в _"Действие с проектом\Android\Установить SDK"_. После установки SDK вам предложат 
создать _цифровой ключ_, который в дальнейшем будет использоваться для подписи пакетов, продаваемых на 
интернет-площадках, например, _Google Play_.
4. **Укажите информацию о вашей игре** выбрав _"Действие с проектом\Android\Настроить"_.
5. Когда игра создана и настроена **подключите Android устройство к компьютеру** и выберите 
_"Действие с проектом\Android\Собрать и установить"_.

### Иконки и экран-заставка

Чтобы задать иконки для приложения, и заставку загрузки разместите соответствующие изображения в корневом каталоге игры.

Иконка состоит из двух изображений переднего плана _android-icon_foreground.png_ с прозрачным фоном и из фонового 
изображения _android-icon_background.png_. Размер этих иконок должен быть 432 x 432 пикселя. При сборке приложения 
Ren'Py преобразует эти файлы в подходящий размер для каждого устройства.

При первом запуске игры на Android или когда игра загружает дополнительные ресурсы с Google Play используются экраны 
заставки. Так как эти процессы занимают некоторое время, то хорошим тоном будет задать данные изображения, поместив их 
в корневую папку игры. Изображение под именем _android-presplash.jpg_, будет использоваться при загрузке приложения, а 
изображение _android-downloading.jpg_ при загрузке ресурсов.

### Сочетания клавиш в Android

При запуске игры Ren'Py на Android кнопки имеют следующие назначение:

* **Домой**: возвращает вас на главный экран Android, приостанавливает игру и автоматически сохраняет её состояние.
* **Увеличение/уменьшение громкости**: используется для регулировки громкости.

### Тестирование Android-приложения

Для тестирования на портативных устройствах Ren'Py поддерживает три режима эмуляции Android: телефон, планшет и 
телевизор. Для её запуска выберите "Действие с проектом\Android\Эмуляция", а далее запускаете требуемый тип эмуляции. 
Для управления игровым процессом используются следующие клавиши: _клик мыши_, который эмулирует касание, _Esc_ для 
вызова меню и _Page Up_ для возврата назад, то есть соответствует кнопке "Назад".

Рассмотрим режимы эмуляции:

* **Телефон**: сенсорное управление имитируется с помощью мыши.
* **Планшет**: управление такое же, как и при эмуляции телефона на Android.
* **Телевизор**: этот режим эмулирует телевизор на базе операционной системы Android. Клавиатура привязана к пульту 
* дистанционного управления, где клавиши со стрелками выполняют навигацию, кнопка _Enter_ это выбор, а _Esc_ вызывает 
* меню. Кроме того, в этом режиме отображаются границы «Небезопасной зоны», в пределах которой контент может 
* отображаться не на всех телевизорах.

### Развертываем на iOS

Развертывать Ren’Py проекты для платформ на iOS можно только на персональном компьютере под управлением macOS. Так как 
поддержка данной платформы находится на стадии разработки, выпушенные игры на основе Ren'Py не соответствуют 
установленным _Apple App Store_ стандартам. Однако, многие игры проходят эту проверку и попадают в Apple App Store. Как 
совет, ваш игра не должна содержать технических проблем, и содержать как можно меньше насилия и обнаженных сцен.

Для тестирования Ren'Py поддерживает два режима эмуляции это iPhone и iPad. Оба режима имитируют работу с сенсорным 
экраном, поэтому управление происходит при помощи мыши. 

Чтобы добавить отладку в Ren’Py на iOS, сперва, нужно загрузить программное обеспечение _renios_. Для этого перейдите 
на лауйнчере Ren’Py "Действие с проектом\iOS", где вам будет предложено загрузить дополнительно программное обеспечение, 
если оно ещё не было установлено. После завершения установки станут доступны новый функционал характерный для устройств 
iOS, особенно такие как _эмуляция_ iPhone и iPad. 

> **Примечание:**
> 
> Хотя эмулятор позволяет увидеть, как работает ваш проект на платформе iOS, но ни что не заменит полноценное тестирование
> на реальном устройстве.

### Xcode и iOS

Следующем шагом трудоёмкого процесса отладки игр на iOS будет установка _интегрированной среды разработки (IDE) Xcode_ 
от Apple. Если вы пользуетесь Mac, следовательно, у вас уже должен быть Apple ID. Тогда, просто скачиваем Xcode с App 
Store на свой Mac и устанавливаем его.

Выполним ещё несколько шагов, чтобы развернуть проект Ren’Py на iOS.

1. **Зарегистрируйтесь в программе _Apple Developer Program_**, перейдя по ссылке: 
https://developer.apple.com/programs/enroll/. Будьте готовы заплатить ежегодно 99 долларов США за участия в данной 
программе.
2. **Через лаунчер Ren’Py создайте новый проект для Xcode**. Для этого выберите 
_"Действие с проектом\iOS\Выбрать Директорию Проектов Xcode"_. Затем _"Создать Проект Xcode"_. Имя проекта будет 
автоматически взято с названия игры в Ren’Py.
3. Далее для **открытия проекта** нажмите _"Запустить Xcode"_.
4. **Добавьте свой Apple ID в Xcode**. Выбираем пункт меню _"Xcode\Preferences"_ и переходим на вкладку _"Accounts"_. 
Используя кнопку плюс в нижней части окна, добавляем свой Apple ID к проекту.
5. **Назначьте свой проект команде**. В Xcode выбираем проект, переходим на вкладку _"General"_, находим раздел 
_"Signing"_. Убеждаемся, что флажок _"Automatically manage signing"_ установлен, и по надобности выбираем команду в 
поле _"Team"_.
6. **Запускаем игры на iOS устройстве**. Подключите устройство к Mac. После запуска проекта на реальном устройстве, 
Xcode настроит все необходимые подписи для развертывания приложения.
7. **Экспортируйте _сертификаты_ и _профили_**. Для этого выбираем пункт меню _"Xcode\Preferences"_ и переходим на 
вкладку _"Accounts"_. Далее внизу окна нажимаем шестерёнку, после чего в выпавшем списке выбираем _"Export Accounts"_.
8. **В открывшемся окне введите имя файла в поле _"Save As"_** и пароль в поля _"Password"_ и _"Verify"_, после чего 
нажмите кнопку _"Save"_. Теперь сохранённый файл с вашей учетной записью разработчика надежно зашифрован и защищен.

Если вам понадобиться восстановить учетную запись разработчика в Xcode, то просто на вкладке "Accounts" выберите 
_"Import Accounts"_ укажите ранее сохранённый файл и нажмите _"Open"_.

### Обновляем ваши iOS-проекты

Если были внесены изменения в проект Ren’Py, то чтобы они появились в проекте Xcode, нужно его обновить, выбрав на 
лаунчере Ren’Py _"Действие с проектом\iOS\Обновить Проект Xcode"_. Однако, если вы выполните обновление Ren’Py, то 
придется повторно пересоздать проект Xcode, для этого используйте инструкцию из предыдущего раздела.

### Иконки и экран-заставка для iOS

Добавления иконок и создание экранов-загрузки для iOS происходит исключительно в Xcode, а их размеры стандартизированы 
(см. Таблицу 6-3).

__Таблица 6-3.__ Спецификация иконок для приложений Apple

| Платформа          | Разрешение (в пикселях) |
|--------------------|-------------------------|
| _iPhone_           | 180 x 180 и 120 x 120   |
| _iPad Pro_         | 167 x 167               |
| _iPad и iPad Mini_ | 152 x 152               |
| _Apple App Store_  | 1024 x 1024             |

> **Примечание:**
>
> В сети есть множество бесплатных сервисов для создания иконок из изображений. 
> Например, сервис _App Icon Generator_ (https://appicon.co).

_Экран загрузки_ в Apple, это обязательный элемент при разработке программного обеспечения, имеющий стандартные 
размеры (см. Таблице 6-4).

> **Примечание:**
>
> Разрешение для горизонтального расположения экрана пропорционально вертикальному
> (например, с 1125 x 2436 на 2436 x 1125).

__Таблица 6-4.__ Спецификация размеров экрана-загрузки для приложений Apple

| iOS-устройство                    | Разрешение (в пикселях) |
|-----------------------------------|-------------------------|
| _iPhone 15_                       | 1179 × 2556             |
| _iPhone 12, iPhone 13, iPhone 14_ | 1170 × 2532             |
| _iPhone 11_                       | 828 × 1792              |
| _iPhone X_                        | 1125 x 2436             |
| _iPhone 8, iPhone 7, iPhone 6s_   | 750 x 1334              |
| _iPhone SE_                       | 640 x 1136              |
| _iPad Pro (12.9")_                | 2048 x 2732             |
| _iPad Pro (11")_                  | 1668 x 2388             |
| _iPad (9.7")_                     | 1536 x 2048             |

Чтобы изменить экран-загрузки, нужно в Xcode добавить изображение в папку _Assets.xcassets_, после чего выбираем 
_LaunchScreen.storyboard_. Далее, используя конструктор, добавляем элемент _UIImageView_, где в свойстве _Image_ 
указываем загруженное изображение.

## Запускаем на Chrome OS и в браузере

_Chrome OS_ — это операционная система на базе Linux от компании Google, где _Chrome_ использует в качестве основного 
браузера. Ноутбуки, работающие под управлением данной операционной системы, называются _Хромбук (Chromebook)_. Одной 
из особенностей Chrome OS это поддержка Android приложений. Поэтому собрав игру Ren’Py для Android, можно запустить и 
протестировать на Chrome OS.

Если игра доступна в _Google Play_, то выполните следующие шаги:

1. Нажмите на время в правом нижнем углу экрана.
2. Выберите значок _настроек_ имеющий вид шестерёнки.
3. В разделе Google Play нажмите _"Включить"_ рядом с надписью _"Устанавливайте приложения и игры из Google Play на 
устройство Chromebook"_.
4. В открывшемся окне выберите _"Ещё"_.
5. Чтобы принять Условия использования, следуйте инструкциям на экране.

> **Примечание**:
> 
> Чтобы устанавливать приложения Android на устройство Chromebook, обновите ChromeOS до последней версии. Если такой 
> параметр не появится, значит ваше устройство не поддерживает приложения Android.

7. Запустите Google Play, найдите нужное приложение и установите его.

Когда игра находится на стадии разработки, и вы хотите её протестировать на Chrome OS, то выполните сборку проекта 
для Android. Далее, полученный .APK файл нужно установить на Chrome OS, но для этого понадобиться включить _режим 
разработчика_, выполнив следующую инструкцию:

1. Нажмите на время в правом нижнем углу экрана Chromebook.
2. Выберите _"Настройки\Дополнительные\Для разработчиков"_.
3. Рядом с надписью _"Среда разработки Linux"_ выберите _"Включить"_.
4. Следуйте инструкциям на экране.
5. Снова нажмите на время на устройстве Chromebook.
6. Выберите _"Настройки\Дополнительные\Для разработчиков"_.
7. На панели слева выберите _"Linux\Разработка приложений для Android"_.
8. Нажмите _"Включить отладку с ADB"_.
9. Выберите _"Перезапустить"_.
10. Нажмите _"Подтвердить"_ и войдите в аккаунт.

Теперь можно установить .APK файл:

1. Откройте терминал.
2. Если не установлен, то установите ADB, выполнив следующую команду: _sudo apt install adb_.
3. Подключитесь к устройству с помощью следующей команды: _adb connect arc_.
4. Появится диалоговое окно авторизации для отладки по USB. Подтвердите, нажав кнопку _"ОК"_.
5. Установите приложение из терминала, применив команду: _adb install [путь к вашему APK]_.
6. Запускаете приложение через _"Панель запуска"_.

Ещё одной возможностью Ren'Py является запуск игр в веб-браузере. Для этого существует отдельная версии Ren'Py, 
скомпилированная при помощи _WebAssembly_.

Чтобы собрать игру для браузера, нужно:

1. На лаунчере Ren'Py выбрать _"Действие с проектом\Web"_. Если дополнительное программное обеспечение ещё не 
установлено установите его.
2. Нажать _"Построить приложение для сети"_.
3. После сборки запустите приложение выбрав _"Открыть в браузере"_.

## Лицензия на Android и iOS в Ren’Py

Ren’Py включает в себя множество сторонних библиотек и технологий, большинство из которых распространяются по лицензии 
_GNU Lesser/Library General Public License_. Сам Ren'Py распространяется под лицензией _MIT_. Про это на всякий случай 
нужно будет упомянуть в описании вашей игры. Например, если вы используете в своём проекте 
_Android Packaging Tool (RAPT)_ и iOS, то добавьте в документацию вашей игры следующие строки:

_Эта программа содержит лицензионное бесплатное программное обеспечение, включая и лицензию GNU Lesser General Public 
License. Ознакомиться с полным списком можно по адресу 
[https://www.renpy.org/doc/html/license.html](https://www.renpy.org/doc/html/license.html)._

## Ren’Py и Raspberry Pi

С 2012 года рынок начинают заполнять так называемые мини ПК. Одним из таких портативных устройств является 
_Raspberry Pi_, цена которого в основном не превышает 40 долларов. На данный момент он всё больше и больше становится 
популярнее, и вы в свою очередь можете извлечь из этого выгоду, выпустив игру Ren’Py для данной платформы.

Но при портировании проекта на Raspberry Pi, вы должны учитывать ограничения данного устройства. Необходимо до предела 
минимизировать аудио, видео и изображения. Если нужно уберите некоторые сцены из игры, то есть урежьте игру, так как 
простой порт с персонального компьютера не является хорошей идеей.

### Настройка Pi для Ren’Py

Так как Raspberry Pi работает под управлением _Raspberry Pi OS_, основанной на Debian GNU/Linux, то и подход в работе 
будет как с операционной системой Linux на базе процессора с архитектурой ARM. Было продемонстрировано, что Ren'Py может 
работать на Raspberry Pi 3B, что касается других моделей работа не гарантируется. Перед тем как начать использовать 
Ren'Py необходимо установить следующие настройки, выполнив команду в терминале _sudo raspi-config_:

* Разделение памяти (Memory Split): 256 МБ
* Разрешение (Resolution): 1280x720 или меньше
* Драйвер GL (GL Driver): GL (Fake KMS)

Далее вам необходимо установить версию SDK для Linux с поддержкой Raspberry Pi. Для этого перейдите на страницу загрузки 
[https://www.renpy.org/latest.html](https://www.renpy.org/latest.html) и выберите _"Download ARM Linux (Raspberry Pi and 
Chromebook) SDK tar.bz2"_.

## TyranoBuilder и персональные компьютеры

У TyranoBuilder имеется очень удобный инструмент для экспорта игр на разные платформы, особенно для Windows, macOS и Web.

Для этого в верхнем меню TyranoBuilder выбираем _"Project\Export Game (Проект\Экспортировать игру)"_. В открывшемся 
окне в поле _"Export Type (Тип экспорта)"_ указываем для какой платформы собрать игру: 
_"Browser Game (Игра для браузера)"_, _"Windows"_ или _"Mac"_, после чего подтверждаем экспорт нажав на кнопку 
_"Output game (Выпустить игру)"_. Через несколько секунд работы приложения, вам будет предложено открыть папку с 
созданной игрой. Вот в принципе и все, ваша игра готова к распространению.

> **Примечание**:
>
> Какой бы не была игра сложной или простой, всегда рекомендуется добавить в неё файлы с руководством и лицензией, а 
> формат файлов предпочтительно использовать PDF.

### TyranoBuilding и iOS

Развернуть игру для мобильного устройства на много сложнее, чем для персонального компьютера. Первый шаг одинаков как 
для iOS так и для Android. В главном меню TyranoBuilder выбираем _"Project\Export Game (Проект\Экспортировать игру)"_. 
В открывшемся окне в поле тип экспорта указываем iOS Application и публикуем игру. Теперь переходим к сложному.

Развертывание игры для iOS на TyranoBuilder очень похоже на развертывание на Ren’Py, для этого понадобится:

* Ноутбук или персональный компьютер Mac.
* Учетная запись разработчика Apple.
* Xcode.

Не забудьте в Xcode настроить _профиль_ и _сертификат_, как это делалось в предыдущих разделах.

Учтите следующие ограничения при отладке игры на iOS: все видеофайлы должны быть в формате mp4, все аудиофайлы иметь 
формат m4a или mp3, не используйте японские символы в именах файлов. Иначе, ваш проект не сможет запуститься.

Далее загружаем и устанавливаем автономную версию _TyranoPlayer_ для iOS по ссылке: 
[http://tyrano.jp/download/player/TyranoPlayerFramework_ios_v112.zip](http://tyrano.jp/download/player/TyranoPlayerFramework_ios_v112.zip)

После этого переходим в папку TyranoPlayer и копируем файлы игры, полученные после экспорта игры из TyranoBuilder, в 
папку _game_. Находим файл _TyranoPlayerFramework.xcodeproj_ и открываем его в Xcode.

Следующим шагом выполняем тестирование игры. Для этого выбираем в верхней части интерфейса Xcode эмулятор для 
тестирования на iPhone или iPad. Если хотите использовать реальное устройство, то подключите его к компьютеру и выберите 
из списка эмуляторов. Далее нажимаем кнопку запуск. 

### TyranoBuilding и Android

